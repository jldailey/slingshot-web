// Generated by CoffeeScript 1.4.0
(function() {
  var $, Bling, extend,
    __slice = [].slice,
    __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; },
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  Object.keys || (Object.keys = function(o) {
    var k, _results;
    _results = [];
    for (k in o) {
      _results.push(k);
    }
    return _results;
  });

  Object.values || (Object.values = function(o) {
    var k, _results;
    _results = [];
    for (k in o) {
      _results.push(o[k]);
    }
    return _results;
  });

  extend = function() {
    var a, b, k, obj, v, _i, _len;
    a = arguments[0], b = 2 <= arguments.length ? __slice.call(arguments, 1) : [];
    for (_i = 0, _len = b.length; _i < _len; _i++) {
      obj = b[_i];
      if (obj) {
        for (k in obj) {
          v = obj[k];
          a[k] = v;
        }
      }
    }
    return a;
  };

  Bling = (function() {

    function Bling() {
      var args;
      args = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
      return Bling.hook("bling-init", args);
    }

    return Bling;

  })();

  Bling.prototype = [];

  Bling.prototype.constructor = Bling;

  Bling.global = typeof window !== "undefined" && window !== null ? window : global;

  Bling.plugin = function(opts, constructor) {
    var key, plugin, _base, _fn, _name, _ref,
      _this = this;
    if (!constructor) {
      constructor = opts;
      opts = {};
    }
    if ("depends" in opts) {
      return this.depends(opts.depends, function() {
        return _this.plugin({
          provides: opts.provides
        }, constructor);
      });
    }
    try {
      if (typeof (plugin = constructor != null ? constructor.call(this, this) : void 0) === "object") {
        ((_base = Bling.plugin)[_name = (_ref = opts.provides) != null ? _ref : ""] || (_base[_name] = [])).push(plugin);
        extend(this, plugin != null ? plugin.$ : void 0);
        delete plugin.$;
        extend(this.prototype, plugin);
        _fn = function(key) {
          return _this[key] || (_this[key] = function() {
            var a;
            a = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
            return _this.prototype[key].apply(Bling(a[0]), a.slice(1));
          });
        };
        for (key in plugin) {
          _fn(key);
        }
        if (opts.provides != null) {
          this.provide(opts.provides);
        }
      }
    } catch (error) {
      console.log("failed to load plugin: " + this.name + " " + error.message + ": " + error.stack);
    }
    return this;
  };

  extend(Bling, (function() {
    var complete, incomplete, waiting;
    waiting = [];
    complete = {};
    incomplete = function(n) {
      return ((typeof n) === "string" ? n.split(/, */) : n).filter(function(x) {
        return !(x in complete);
      });
    };
    return {
      depends: function(needs, func) {
        if ((needs = incomplete(needs)).length === 0) {
          func();
        } else {
          waiting.push(function(need) {
            var i;
            if ((i = needs.indexOf(need)) > -1) {
              needs.splice(i, 1);
            }
            return needs.length === 0 && func;
          });
        }
        return func;
      },
      provide: function(needs, data) {
        var func, i, need, _i, _len, _ref;
        _ref = incomplete(needs);
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          need = _ref[_i];
          complete[need] = i = 0;
          while (i < waiting.length) {
            if ((func = waiting[i](need))) {
              waiting.splice(i, 1);
              func(data);
              i = 0;
            } else {
              i++;
            }
          }
        }
        return data;
      }
    };
  })());

  $ = Bling;

  $.plugin({
    provides: "EventEmitter",
    depends: "type,hook"
  }, function() {
    return {
      $: {
        EventEmitter: $.hook("bling-init").append(function(obj) {
          var list, listeners;
          if (obj == null) {
            obj = Object.create(null);
          }
          listeners = {};
          list = function(e) {
            return listeners[e] || (listeners[e] = []);
          };
          return $.inherit({
            emit: function() {
              var a, e, f, _i, _len, _ref;
              e = arguments[0], a = 2 <= arguments.length ? __slice.call(arguments, 1) : [];
              _ref = list(e);
              for (_i = 0, _len = _ref.length; _i < _len; _i++) {
                f = _ref[_i];
                f.apply(this, a);
              }
              return this;
            },
            addListener: function(e, h) {
              list(e).push(h);
              return this.emit('newListener', e, h);
            },
            on: function(e, h) {
              return this.addListener(e, h);
            },
            removeListener: function(e, h) {
              var i;
              if ((i = list(e).indexOf(h)) > -1) {
                return list(e).splice(i, 1);
              }
            },
            removeAllListeners: function(e) {
              return listeners[e] = [];
            },
            setMaxListeners: function(n) {},
            listeners: function(e) {
              return list(e).slice(0);
            }
          }, obj);
        })
      }
    };
  });

  $.plugin({
    provides: "cartesian"
  }, function() {
    return {
      $: {
        cartesian: function() {
          var helper, n, ret, sets;
          sets = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
          n = sets.length;
          ret = [];
          helper = function(cur, i) {
            var x, _i, _len, _ref;
            if (++i >= n) {
              return ret.push(cur);
            }
            _ref = sets[i];
            for (_i = 0, _len = _ref.length; _i < _len; _i++) {
              x = _ref[_i];
              helper(cur.concat(x), i);
            }
            return null;
          };
          helper([], -1);
          return $(ret);
        }
      }
    };
  });

  $.plugin(function() {
    var oldClone, _base, _base1, _base2, _base3;
    (_base = String.prototype).trimLeft || (_base.trimLeft = function() {
      return this.replace(/^\s+/, "");
    });
    (_base1 = String.prototype).split || (_base1.split = function(sep) {
      var a, i, j;
      a = [];
      i = 0;
      while ((j = this.indexOf(sep, i)) > -1) {
        a.push(this.substring(i, j));
        i = j + 1;
      }
      return a;
    });
    (_base2 = String.prototype).lastIndexOf || (_base2.lastIndexOf = function(s, c, i) {
      var j;
      if (i == null) {
        i = -1;
      }
      j = -1;
      while ((i = s.indexOf(c, i + 1)) > -1) {
        j = i;
      }
      return j;
    });
    (_base3 = Array.prototype).join || (_base3.join = function(sep) {
      var n, s;
      if (sep == null) {
        sep = '';
      }
      n = this.length;
      if (n === 0) {
        return "";
      }
      s = this[n - 1];
      while (--n > 0) {
        s = this[n - 1] + sep + s;
      }
      return s;
    });
    if (typeof Event !== "undefined" && Event !== null) {
      Event.prototype.preventAll = function() {
        this.preventDefault();
        this.stopPropagation();
        return this.cancelBubble = true;
      };
    }
    if (typeof Element !== "undefined" && Element !== null) {
      Element.prototype.matchesSelector = Element.prototype.webkitMatchesSelector || Element.prototype.mozMatchesSelector || Element.prototype.matchesSelector;
      if (Element.prototype.cloneNode.length === 0) {
        oldClone = Element.prototype.cloneNode;
        Element.prototype.cloneNode = function(deep) {
          var i, n, _i, _len, _ref;
          if (deep == null) {
            deep = false;
          }
          n = oldClone.call(this);
          if (deep) {
            _ref = this.childNodes;
            for (_i = 0, _len = _ref.length; _i < _len; _i++) {
              i = _ref[_i];
              n.appendChild(i.cloneNode(true));
            }
          }
          return n;
        };
      }
    }
    return {};
  });

  $.plugin({
    provides: 'config',
    depends: 'type'
  }, function() {
    var get, set;
    get = function(name, def) {
      var _ref;
      return (_ref = process.env[name]) != null ? _ref : def;
    };
    set = function(name, val) {
      return process.env[name] = val;
    };
    return {
      $: {
        config: $.extend(get, {
          get: get,
          set: set
        })
      }
    };
  });

  $.plugin({
    provides: "core",
    depends: "string"
  }, function() {
    var baseTime, index;
    $.defineProperty($, "now", {
      get: function() {
        return +(new Date);
      }
    });
    index = function(i, o) {
      while (i < 0) {
        i += o.length;
      }
      return Math.min(i, o.length);
    };
    baseTime = $.now;
    return {
      $: {
        log: $.extend(function() {
          var a, prefix;
          a = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
          prefix = "+" + ($.padLeft(String($.now - baseTime), $.log.prefixSize, '0')) + ":";
          if (prefix.length > $.log.prefixSize + 2) {
            prefix = "" + (baseTime = $.now) + ":";
          }
          if (a.length && $.is("string", a[0])) {
            a[0] = "" + prefix + " " + a[0];
          } else {
            a.unshift(prefix);
          }
          console.log.apply(console, a);
          if (a.length) {
            return a[a.length - 1];
          }
        }, {
          prefixSize: 5
        }),
        assert: function(c, m) {
          if (m == null) {
            m = "";
          }
          if (!c) {
            throw new Error("assertion failed: " + m);
          }
        },
        coalesce: function() {
          var a;
          a = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
          return $(a).coalesce();
        },
        keysOf: function(o) {
          var k;
          return $((function() {
            var _results;
            _results = [];
            for (k in o) {
              _results.push(k);
            }
            return _results;
          })());
        },
        valuesOf: function(o) {
          return $.keysOf(o).map(function(k) {
            try {
              return o[k];
            } catch (err) {
              return err;
            }
          });
        }
      },
      eq: function(i) {
        return $([this[index(i, this)]]);
      },
      each: function(f) {
        var t, _i, _len;
        for (_i = 0, _len = this.length; _i < _len; _i++) {
          t = this[_i];
          f.call(t, t);
        }
        return this;
      },
      map: function(f) {
        var b, t, _i, _len;
        b = $();
        for (_i = 0, _len = this.length; _i < _len; _i++) {
          t = this[_i];
          b.push(f.call(t, t));
        }
        return b;
      },
      filterMap: function(f) {
        var b, t, v, _i, _len;
        b = $();
        for (_i = 0, _len = this.length; _i < _len; _i++) {
          t = this[_i];
          v = f.call(t, t);
          if (v != null) {
            b.push(v);
          }
        }
        return b;
      },
      replaceWith: function(array) {
        var i, _i, _ref, _results;
        _results = [];
        for (i = _i = 0, _ref = array.length; _i < _ref; i = _i += 1) {
          _results.push(this[i] = array[i]);
        }
        return _results;
      },
      reduce: function(f, a) {
        var i, n, x, _i;
        i = 0;
        n = this.length;
        if (!(a != null)) {
          a = this[i++];
        }
        for (x = _i = i; _i < n; x = _i += 1) {
          a = f.call(this[x], a, this[x]);
        }
        return a;
      },
      union: function(other, strict) {
        var ret, x, _i, _j, _len, _len1;
        if (strict == null) {
          strict = true;
        }
        ret = $();
        for (_i = 0, _len = this.length; _i < _len; _i++) {
          x = this[_i];
          if (!ret.contains(x, strict)) {
            ret.push(x);
          }
        }
        for (_j = 0, _len1 = other.length; _j < _len1; _j++) {
          x = other[_j];
          if (!ret.contains(x, strict)) {
            ret.push(x);
          }
        }
        return ret;
      },
      distinct: function(strict) {
        if (strict == null) {
          strict = true;
        }
        return this.union(this, strict);
      },
      intersect: function(other) {
        var x;
        return $((function() {
          var _i, _len, _results;
          _results = [];
          for (_i = 0, _len = this.length; _i < _len; _i++) {
            x = this[_i];
            if (__indexOf.call(other, x) >= 0) {
              _results.push(x);
            }
          }
          return _results;
        }).call(this));
      },
      contains: function(item, strict) {
        var t;
        if (strict == null) {
          strict = true;
        }
        return ((function() {
          var _i, _len, _results;
          _results = [];
          for (_i = 0, _len = this.length; _i < _len; _i++) {
            t = this[_i];
            _results.push((strict && t === item) || (!strict && t == item));
          }
          return _results;
        }).call(this)).reduce((function(a, x) {
          return a || x;
        }), false);
      },
      count: function(item, strict) {
        var t;
        if (strict == null) {
          strict = true;
        }
        return $((function() {
          var _i, _len, _results;
          _results = [];
          for (_i = 0, _len = this.length; _i < _len; _i++) {
            t = this[_i];
            if ((item === void 0) || (strict && t === item) || (!strict && t == item)) {
              _results.push(1);
            }
          }
          return _results;
        }).call(this)).sum();
      },
      coalesce: function() {
        var i, _i, _len;
        for (_i = 0, _len = this.length; _i < _len; _i++) {
          i = this[_i];
          if ($.is('array', i) || $.is('bling', i)) {
            i = $(i).coalesce();
          }
          if (i != null) {
            return i;
          }
        }
        return null;
      },
      swap: function(i, j) {
        var _ref;
        i = index(i, this);
        j = index(j, this);
        if (i !== j) {
          _ref = [this[j], this[i]], this[i] = _ref[0], this[j] = _ref[1];
        }
        return this;
      },
      shuffle: function() {
        var i;
        i = this.length - 1;
        while (i >= 0) {
          this.swap(--i, Math.floor(Math.random() * i));
        }
        return this;
      },
      select: (function() {
        var getter, selectMany, selectOne;
        getter = function(prop) {
          return function() {
            var v;
            if ($.is("function", v = this[prop])) {
              return $.bound(this, v);
            } else {
              return v;
            }
          };
        };
        selectOne = function(p) {
          var i;
          if ((i = p.indexOf('.')) > -1) {
            return this.select(p.substr(0, i)).select(p.substr(i + 1));
          } else {
            return this.map(getter(p));
          }
        };
        selectMany = function() {
          var a, i, lists, n, p, _i, _len;
          a = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
          n = this.length;
          lists = Object.create(null);
          for (_i = 0, _len = a.length; _i < _len; _i++) {
            p = a[_i];
            lists[p] = this.select(p);
          }
          i = 0;
          return this.map(function() {
            var obj;
            obj = Object.create(null);
            for (p in lists) {
              obj[$(p.split('.')).last()] = lists[p][i];
            }
            i++;
            return obj;
          });
        };
        return function() {
          switch (arguments.length) {
            case 1:
              return selectOne.apply(this, arguments);
            case 2:
              return selectMany.apply(this, arguments);
          }
        };
      })(),
      or: function(x) {
        var i, _i, _ref;
        for (i = _i = 0, _ref = this.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
          this[i] || (this[i] = x);
        }
        return this;
      },
      zap: function(p, v) {
        var head, i, k, tail;
        if (($.is('object', p)) && !(v != null)) {
          for (k in p) {
            v = p[k];
            this.zap(k, v);
          }
          return this;
        }
        i = p.lastIndexOf(".");
        if (i > 0) {
          head = p.substr(0, i);
          tail = p.substr(i + 1);
          this.select(head).zap(tail, v);
          return this;
        }
        switch ($.type(v)) {
          case "array":
          case "bling":
            this.each(function() {
              return this[p] = v[++i % v.length];
            });
            break;
          case "function":
            this.zap(p, this.select(p).map(v));
            break;
          default:
            this.each(function() {
              return this[p] = v;
            });
        }
        return this;
      },
      clean: function(prop) {
        return this.each(function() {
          return delete this[prop];
        });
      },
      take: function(n) {
        var end, i;
        if (n == null) {
          n = 1;
        }
        end = Math.min(n, this.length);
        return $((function() {
          var _i, _results;
          _results = [];
          for (i = _i = 0; _i < end; i = _i += 1) {
            _results.push(this[i]);
          }
          return _results;
        }).call(this));
      },
      skip: function(n) {
        var i, start;
        if (n == null) {
          n = 0;
        }
        start = Math.max(0, n | 0);
        return $((function() {
          var _i, _ref, _results;
          _results = [];
          for (i = _i = start, _ref = this.length; _i < _ref; i = _i += 1) {
            _results.push(this[i]);
          }
          return _results;
        }).call(this));
      },
      first: function(n) {
        if (n == null) {
          n = 1;
        }
        if (n === 1) {
          return this[0];
        } else {
          return this.take(n);
        }
      },
      last: function(n) {
        if (n == null) {
          n = 1;
        }
        if (n === 1) {
          return this[this.length - 1];
        } else {
          return this.skip(this.length - n);
        }
      },
      slice: function(start, end) {
        var i;
        if (start == null) {
          start = 0;
        }
        if (end == null) {
          end = this.length;
        }
        start = index(start, this);
        end = index(end, this);
        return $((function() {
          var _i, _results;
          _results = [];
          for (i = _i = start; start <= end ? _i < end : _i > end; i = start <= end ? ++_i : --_i) {
            _results.push(this[i]);
          }
          return _results;
        }).call(this));
      },
      extend: function(b) {
        var i, _i, _len;
        for (_i = 0, _len = b.length; _i < _len; _i++) {
          i = b[_i];
          this.push(i);
        }
        return this;
      },
      push: function(b) {
        Array.prototype.push.call(this, b);
        return this;
      },
      filter: function(f, limit) {
        var a, g, it, _i, _len;
        if (limit == null) {
          limit = this.length;
        }
        g = (function() {
          switch ($.type(f)) {
            case "string":
              return function(x) {
                return x.matchesSelector(f);
              };
            case "regexp":
              return function(x) {
                return f.test(x);
              };
            case "function":
              return f;
            default:
              throw new Error("unsupported argument to filter: " + ($.type(f)));
          }
        })();
        a = $();
        for (_i = 0, _len = this.length; _i < _len; _i++) {
          it = this[_i];
          if (g.call(it, it)) {
            if (--limit < 0) {
              break;
            }
            a.push(it);
          }
        }
        return a;
      },
      matches: function(expr) {
        switch ($.type(expr)) {
          case "string":
            return this.select('matchesSelector').call(expr);
          case "regexp":
            return this.map(function(x) {
              return expr.test(x);
            });
          default:
            throw new Error("unsupported argument to matches: " + ($.type(expr)));
        }
      },
      querySelectorAll: function(expr) {
        return this.filter("*").reduce(function(a, i) {
          return a.extend(i.querySelectorAll(expr));
        }, $());
      },
      weave: function(b) {
        var c, i, _i, _j, _ref, _ref1;
        c = $();
        for (i = _i = _ref = this.length - 1; _i >= 0; i = _i += -1) {
          c[(i * 2) + 1] = this[i];
        }
        for (i = _j = 0, _ref1 = b.length; _j < _ref1; i = _j += 1) {
          c[i * 2] = b[i];
        }
        return c;
      },
      fold: function(f) {
        var b, i, n;
        n = this.length;
        b = $((function() {
          var _i, _ref, _results;
          _results = [];
          for (i = _i = 0, _ref = n - 1; _i < _ref; i = _i += 2) {
            _results.push(f.call(this, this[i], this[i + 1]));
          }
          return _results;
        }).call(this));
        if ((n % 2) === 1) {
          b.push(f.call(this, this[n - 1], void 0));
        }
        return b;
      },
      flatten: function() {
        var b, i, j, _i, _j, _len, _len1;
        b = $();
        for (_i = 0, _len = this.length; _i < _len; _i++) {
          i = this[_i];
          for (_j = 0, _len1 = i.length; _j < _len1; _j++) {
            j = i[_j];
            b.push(j);
          }
        }
        return b;
      },
      call: function() {
        return this.apply(null, arguments);
      },
      apply: function(context, args) {
        return this.filterMap(function() {
          if ($.is('function', this)) {
            return this.apply(context, args);
          } else {
            return null;
          }
        });
      },
      log: function(label) {
        if (label) {
          $.log(label, this.toString(), this.length + " items");
        } else {
          $.log(this.toString(), this.length + " items");
        }
        return this;
      },
      toArray: function() {
        this.__proto__ = Array.prototype;
        return this;
      }
    };
  });

  $.plugin({
    provides: 'date',
    depends: 'type'
  }, function() {
    var adder, d, floor, format_keys, formats, h, m, ms, parser_keys, parsers, s, units, _ref;
    _ref = [1, 1000, 1000 * 60, 1000 * 60 * 60, 1000 * 60 * 60 * 24], ms = _ref[0], s = _ref[1], m = _ref[2], h = _ref[3], d = _ref[4];
    units = {
      ms: ms,
      s: s,
      m: m,
      h: h,
      d: d,
      sec: s,
      second: s,
      seconds: s,
      min: m,
      minute: m,
      minutes: m,
      hr: h,
      hour: h,
      hours: h,
      day: d,
      days: d
    };
    formats = {
      yyyy: Date.prototype.getUTCFullYear,
      mm: function() {
        return this.getUTCMonth() + 1;
      },
      dd: Date.prototype.getUTCDate,
      HH: Date.prototype.getUTCHours,
      MM: Date.prototype.getUTCMinutes,
      SS: Date.prototype.getUTCSeconds,
      MS: Date.prototype.getUTCMilliseconds
    };
    format_keys = Object.keys(formats).sort().reverse();
    parsers = {
      yyyy: Date.prototype.setUTCFullYear,
      mm: function(x) {
        return this.setUTCMonth(x - 1);
      },
      dd: Date.prototype.setUTCDate,
      HH: Date.prototype.setUTCHours,
      MM: Date.prototype.setUTCMinutes,
      SS: Date.prototype.setUTCSeconds,
      MS: Date.prototype.setUTCMilliseconds
    };
    parser_keys = Object.keys(parsers).sort().reverse();
    floor = Math.floor;
    $.type.register("date", {
      match: function(o) {
        return $.isType(Date, o);
      },
      array: function(o) {
        return [o];
      },
      string: function(o, fmt, unit) {
        return $.date.format(o, fmt, unit);
      },
      number: function(o, unit) {
        return $.date.stamp(o, unit);
      }
    });
    $.type.extend('string', {
      date: function(o, fmt) {
        if (fmt == null) {
          fmt = $.date.defaultFormat;
        }
        return new Date($.date.parse(o, fmt, "ms"));
      }
    });
    $.type.extend('number', {
      date: function(o, unit) {
        return $.date.unstamp(o, unit);
      }
    });
    adder = function(key) {
      return function(stamp, delta, stamp_unit) {
        var date;
        if (stamp_unit == null) {
          stamp_unit = $.date.defaultUnit;
        }
        date = $.date.unstamp(stamp, stamp_unit);
        parsers[key].call(date, (formats[key].call(date)) + delta);
        return $.date.stamp(date, stamp_unit);
      };
    };
    return {
      $: {
        date: {
          defaultUnit: "s",
          defaultFormat: "yyyy-mm-dd HH:MM:SS",
          stamp: function(date, unit) {
            if (date == null) {
              date = new Date;
            }
            if (unit == null) {
              unit = $.date.defaultUnit;
            }
            return floor(date / units[unit]);
          },
          unstamp: function(stamp, unit) {
            if (unit == null) {
              unit = $.date.defaultUnit;
            }
            return new Date(floor(stamp * units[unit]));
          },
          convert: function(stamp, from, to) {
            if (from == null) {
              from = $.date.defaultUnit;
            }
            if (to == null) {
              to = $.date.defaultUnit;
            }
            if ($.is("date", stamp)) {
              stamp = $.date.stamp(stamp, from);
            }
            return floor(stamp * units[from] / units[to]);
          },
          midnight: function(stamp, unit) {
            if (unit == null) {
              unit = $.date.defaultUnit;
            }
            return $.date.convert($.date.convert(stamp, unit, "d"), "d", unit);
          },
          format: function(stamp, fmt, unit) {
            var date, k, _i, _len;
            if (fmt == null) {
              fmt = $.date.defaultFormat;
            }
            if (unit == null) {
              unit = $.date.defaultUnit;
            }
            if ($.is("date", stamp)) {
              stamp = $.date.stamp(stamp, unit);
            }
            date = $.date.unstamp(stamp, unit);
            for (_i = 0, _len = format_keys.length; _i < _len; _i++) {
              k = format_keys[_i];
              fmt = fmt.replace(k, $.padLeft("" + formats[k].call(date), k.length, "0"));
            }
            return fmt;
          },
          parse: function(dateString, fmt, to) {
            var date, i, k, _i, _j, _len, _ref1;
            if (fmt == null) {
              fmt = $.date.defaultFormat;
            }
            if (to == null) {
              to = $.date.defaultUnit;
            }
            date = new Date(0);
            for (i = _i = 0, _ref1 = fmt.length; _i < _ref1; i = _i += 1) {
              for (_j = 0, _len = parser_keys.length; _j < _len; _j++) {
                k = parser_keys[_j];
                if (fmt.indexOf(k, i) === i) {
                  try {
                    parsers[k].call(date, parseInt(dateString.slice(i, i + k.length), 10));
                  } catch (err) {
                    throw new Error("Invalid date ('" + dateString + "') given format mask: " + fmt + " (failed at position " + i + ")");
                  }
                }
              }
            }
            return $.date.stamp(date, to);
          },
          addMilliseconds: adder("MS"),
          addSeconds: adder("SS"),
          addMinutes: adder("MM"),
          addHours: adder("HH"),
          addDays: adder("dd"),
          addMonths: adder("mm"),
          addYears: adder("yyyy"),
          range: function(from, to, interval, interval_unit, stamp_unit) {
            var add, cur, ret;
            if (interval == null) {
              interval = 1;
            }
            if (interval_unit == null) {
              interval_unit = "dd";
            }
            if (stamp_unit == null) {
              stamp_unit = $.date.defaultUnit;
            }
            add = adder(interval_unit);
            ret = [from];
            while ((cur = ret[ret.length - 1]) < to) {
              ret.push(add(cur, interval, stamp_unit));
            }
            return ret;
          }
        }
      },
      midnight: function(unit) {
        if (unit == null) {
          unit = $.date.defaultUnit;
        }
        return this.map(function() {
          return $.date.midnight(this, unit);
        });
      },
      unstamp: function(unit) {
        if (unit == null) {
          unit = $.date.defaultUnit;
        }
        return this.map(function() {
          return $.date.unstamp(this, unit);
        });
      },
      stamp: function(unit) {
        if (unit == null) {
          unit = $.date.defaultUnit;
        }
        return this.map(function() {
          return $.date.stamp(this, unit);
        });
      },
      dateFormat: function(fmt, unit) {
        if (fmt == null) {
          fmt = $.date.defaultFormat;
        }
        if (unit == null) {
          unit = $.date.defaultUnit;
        }
        return this.map(function() {
          return $.date.format(this, fmt, unit);
        });
      },
      dateParse: function(fmt, unit) {
        if (fmt == null) {
          fmt = $.date.defaultFormat;
        }
        if (unit == null) {
          unit = $.date.defaultUnit;
        }
        return this.map(function() {
          return $.date.parse(this, fmt, unit);
        });
      }
    };
  });

  $.plugin({
    provides: "delay",
    depends: "function"
  }, function() {
    return {
      $: {
        delay: (function() {
          var timeoutQueue;
          timeoutQueue = $.extend([], (function() {
            var next;
            next = function(a) {
              return function() {
                if (a.length) {
                  return a.shift()();
                }
              };
            };
            return {
              add: function(f, n) {
                var i, _i, _ref;
                f.order = n + $.now;
                for (i = _i = 0, _ref = this.length; _i <= _ref; i = _i += 1) {
                  if (i === this.length || this[i].order > f.order) {
                    this.splice(i, 0, f);
                    break;
                  }
                }
                setTimeout(next(this), n);
                return this;
              },
              cancel: function(f) {
                var i, _i, _ref;
                for (i = _i = 0, _ref = this.length; _i < _ref; i = _i += 1) {
                  if (this[i] === f) {
                    this.splice(i, 1);
                    break;
                  }
                }
                return this;
              }
            };
          })());
          return function(n, f) {
            if ($.is("function", f)) {
              timeoutQueue.add(f, n);
            }
            return {
              cancel: function() {
                return timeoutQueue.cancel(f);
              }
            };
          };
        })()
      },
      delay: function(n, f, c) {
        if (c == null) {
          c = this;
        }
        $.delay(n, $.bound(c, f));
        return this;
      },
      interval: function(n, f, c) {
        var g, h;
        if (c == null) {
          c = this;
        }
        g = $.bound(c, f);
        h = function() {
          g();
          return $.delay(n, h);
        };
        $.delay(n, h);
        return this;
      }
    };
  });

  $.plugin({
    depends: 'hook,synth,delay',
    provides: 'dialog'
  }, function() {
    var createDialog, injectCSS;
    injectCSS = function() {
      $('head style.dialog').remove();
      return $.synth('style.dialog "\
			.modal {\
				position: absolute;\
				background: rgba(0,0,0,.3);\
			}\
			.dialog {\
				position: absolute;\
				box-shadow: 8px 8px 4px rgba(0,0,0,.4);\
				border-radius: 8px;\
				background: white;\
				padding: 6px;\
				-webkit-transition-property: left;\
				-webkit-transition-duration: .15s;\
				-moz-transition-property: left;\
				-moz-transition-duration: .15s;\
			}\
			.dialog > .title {\
				text-align: center;\
				width: 100%;\
			}\
			.dialog > .content {\
				width: 100%;\
			}\
		"'.replace(/\t+/g, ' ')).prependTo("head");
    };
    createDialog = function(opts) {
      var contentNode, dialog, dialogSynth, modal, titleNode;
      opts = $.extend(createDialog.getDefaultOptions(), opts);
      injectCSS();
      dialogSynth = "div.dialog#" + opts.id + " div.title + div.content";
      modal = $.synth("div.modal " + dialogSynth).appendTo("body").click(function(evt) {
        if (evt.target === modal[0]) {
          $.log('dialog: Closing because the modal was clicked.');
          return opts.cancel(modal);
        }
      });
      dialog = modal.find('.dialog');
      modal.delegate(".cancel", "click", function(evt) {
        return opts.cancel(modal);
      }).delegate(".ok", "click", function(evt) {
        return opts.ok(modal);
      });
      contentNode = dialog.find('.content').take(1);
      contentNode.append(createDialog.getContent(opts.contentType, opts.content));
      titleNode = dialog.find('.title').take(1);
      titleNode.append(createDialog.getContent(opts.titleType, opts.title));
      return modal.fitOver(opts.target).show().find('.dialog').centerOn(modal).show();
    };
    createDialog.getDefaultOptions = function() {
      return {
        id: "dialog-" + $.random.string(4),
        target: "body",
        title: "Untitled Dialog",
        titleType: "text",
        content: "span 'Dialog Content'",
        contentType: "synth",
        ok: function(modal) {
          $.log("dialog: Closing from default ok");
          return modal.remove();
        },
        cancel: function(modal) {
          $.log("dialog: Closign from default cancel");
          return modal.remove();
        }
      };
    };
    createDialog.getContent = function(type, stuff) {
      switch (type) {
        case "synth":
          return $.synth(stuff);
        case "html":
          return $.HTML.parse(stuff);
        case "text":
          return document.createTextNode(stuff);
      }
    };
    return {
      $: {
        dialog: createDialog
      },
      fitOver: function(elem) {
        var rect;
        if (elem == null) {
          elem = window;
        }
        if (elem === window) {
          rect = {
            width: window.innerWidth,
            height: window.innerHeight,
            top: 0,
            left: 0
          };
        } else {
          rect = $(elem).rect().first();
        }
        return this.css({
          position: 'absolute',
          width: $.px(rect.width),
          height: $.px(rect.height),
          top: $.px(rect.top),
          left: $.px(rect.left)
        });
      },
      centerOn: function(elem) {
        var left, target, top;
        if (elem == null) {
          elem = window;
        }
        if (elem === window) {
          target = {
            width: window.innerWidth,
            height: window.innerHeight,
            top: 0,
            left: 0
          };
        } else {
          target = $(elem).rect().first();
        }
        top = target.height / 2;
        left = target.width / 2;
        return this.each(function() {
          var dialog, rect;
          dialog = $(this);
          rect = dialog.rect().first();
          return dialog.css({
            top: $.px(top - (rect.height / 2)),
            left: $.px(left - (rect.width / 2))
          });
        });
      }
    };
  });

  if ($.global.document != null) {
    $.plugin({
      depends: "function,type",
      provides: "dom"
    }, function() {
      var after, before, computeCSSProperty, escaper, getOrSetRect, parser, selectChain, toFrag, toNode;
      $.type.register("nodelist", {
        match: function(o) {
          return (o != null) && $.isType("NodeList", o);
        },
        hash: function(o) {
          var i;
          return $((function() {
            var _i, _len, _results;
            _results = [];
            for (_i = 0, _len = x.length; _i < _len; _i++) {
              i = x[_i];
              _results.push($.hash(i));
            }
            return _results;
          })()).sum();
        },
        array: $.identity,
        string: function(o) {
          return "{Nodelist:[" + $(o).select('nodeName').join(",") + "]}";
        },
        node: function(o) {
          return $(o).toFragment();
        }
      });
      $.type.register("node", {
        match: function(o) {
          return (o != null ? o.nodeType : void 0) > 0;
        },
        hash: function(o) {
          return $.checksum(o.nodeName) + $.hash(o.attributes) + $.checksum(o.innerHTML);
        },
        string: function(o) {
          return o.toString();
        },
        node: $.identity
      });
      $.type.register("fragment", {
        match: function(o) {
          return (o != null ? o.nodeType : void 0) === 11;
        },
        hash: function(o) {
          var x;
          return $((function() {
            var _i, _len, _ref, _results;
            _ref = o.childNodes;
            _results = [];
            for (_i = 0, _len = _ref.length; _i < _len; _i++) {
              x = _ref[_i];
              _results.push($.hash(x));
            }
            return _results;
          })()).sum();
        },
        string: function(o) {
          return o.toString();
        },
        node: $.identity
      });
      $.type.register("html", {
        match: function(o) {
          var s;
          return typeof o === "string" && (s = o.trimLeft())[0] === "<" && s[s.length - 1] === ">";
        },
        node: function(h) {
          var childNodes, df, i, n, node, _i;
          (node = document.createElement('div')).innerHTML = h;
          if (n = (childNodes = node.childNodes).length === 1) {
            return node.removeChild(childNodes[0]);
          }
          df = document.createDocumentFragment();
          for (i = _i = 0; _i < n; i = _i += 1) {
            df.appendChild(node.removeChild(childNodes[0]));
          }
          return df;
        },
        array: function(o) {
          var h;
          return $.type.lookup(h = Bling.HTML.parse(o)).array(h);
        },
        string: function(o) {
          return "'" + o + "'";
        },
        repr: function(o) {
          return '"' + o + '"';
        }
      });
      $.type.extend({
        unknown: {
          node: function() {
            return null;
          }
        },
        bling: {
          node: function(o) {
            return o.toFragment();
          }
        },
        node: {
          html: function(n) {
            var d, ret;
            d = document.createElement("div");
            d.appendChild((n = n.cloneNode(true)));
            ret = d.innerHTML;
            d.removeChild(n);
            return ret;
          }
        },
        string: {
          node: function(o) {
            return $(o).toFragment();
          },
          array: function(o) {
            return typeof document.querySelectorAll === "function" ? document.querySelectorAll(o) : void 0;
          }
        },
        "function": {
          node: function(o) {
            return $(o.toString()).toFragment();
          }
        }
      });
      toFrag = function(a) {
        var df;
        if (!(a.parentNode != null)) {
          df = document.createDocumentFragment();
          df.appendChild(a);
        }
        return a;
      };
      before = function(a, b) {
        return toFrag(a).parentNode.insertBefore(b, a);
      };
      after = function(a, b) {
        return toFrag(a).parentNode.insertBefore(b, a.nextSibling);
      };
      toNode = function(x) {
        return $.type.lookup(x).node(x);
      };
      escaper = false;
      parser = false;
      computeCSSProperty = function(k) {
        return function() {
          return $.global.getComputedStyle(this, null).getPropertyValue(k);
        };
      };
      getOrSetRect = function(p) {
        return function(x) {
          if (x != null) {
            return this.css(p, x);
          } else {
            return this.rect().select(p);
          }
        };
      };
      selectChain = function(prop) {
        return function() {
          return this.map(function(p) {
            return $((function() {
              var _results;
              _results = [];
              while (p = p[prop]) {
                _results.push(p);
              }
              return _results;
            })());
          });
        };
      };
      return {
        $: {
          HTML: {
            parse: function(h) {
              return $.type.lookup(h).node(h);
            },
            stringify: function(n) {
              return $.type.lookup(n).html(n);
            },
            escape: function(h) {
              var ret;
              escaper || (escaper = $("<div>&nbsp;</div>").child(0));
              ret = escaper.zap('data', h).select("parentNode.innerHTML").first();
              escaper.zap('data', '');
              return ret;
            }
          }
        },
        html: function(h) {
          switch ($.type(h)) {
            case "undefined":
            case "null":
              return this.select('innerHTML');
            case "string":
            case "html":
              return this.zap('innerHTML', h);
            case "bling":
              return this.html(h.toFragment());
            case "node":
              return this.each(function() {
                var _results;
                this.replaceChild(this.childNodes[0], h);
                _results = [];
                while (this.childNodes.length > 1) {
                  _results.push(this.removeChild(this.childNodes[1]));
                }
                return _results;
              });
          }
        },
        append: function(x) {
          x = toNode(x);
          return this.each(function() {
            return this.appendChild(x.cloneNode(true));
          });
        },
        appendTo: function(x) {
          var clones, i;
          clones = this.map(function() {
            return this.cloneNode(true);
          });
          i = 0;
          $(x).each(function() {
            return this.appendChild(clones[i++]);
          });
          return clones;
        },
        prepend: function(x) {
          if (x != null) {
            x = toNode(x);
            this.take(1).each(function() {
              return before(this.childNodes[0], x);
            });
            this.skip(1).each(function() {
              return before(this.childNodes[0], x.cloneNode(true));
            });
          }
          return this;
        },
        prependTo: function(x) {
          if (x != null) {
            $(x).prepend(this);
          }
          return this;
        },
        before: function(x) {
          if (x != null) {
            x = toNode(x);
            this.take(1).each(function() {
              return before(this, x);
            });
            this.skip(1).each(function() {
              return before(this, x.cloneNode(true));
            });
          }
          return this;
        },
        after: function(x) {
          if (x != null) {
            x = toNode(x);
            this.take(1).each(function() {
              return after(this, x);
            });
            this.skip(1).each(function() {
              return after(this, x.cloneNode(true));
            });
          }
          return this;
        },
        wrap: function(parent) {
          parent = toNode(parent);
          if ($.is("fragment", parent)) {
            throw new Error("cannot call .wrap() with a fragment as the parent");
          }
          return this.each(function(child) {
            var grandpa, marker;
            if (($.is("fragment", child)) || !child.parentNode) {
              return parent.appendChild(child);
            }
            grandpa = child.parentNode;
            marker = document.createElement("dummy");
            parent.appendChild(grandpa.replaceChild(marker, child));
            return grandpa.replaceChild(parent, marker);
          });
        },
        unwrap: function() {
          return this.each(function() {
            if (this.parentNode && this.parentNode.parentNode) {
              return this.parentNode.parentNode.replaceChild(this, this.parentNode);
            } else if (this.parentNode) {
              return this.parentNode.removeChild(this);
            }
          });
        },
        replace: function(n) {
          var clones, i, _i, _ref, _ref1;
          n = toNode(n);
          clones = this.map(function() {
            return n.cloneNode(true);
          });
          for (i = _i = 0, _ref = clones.length; _i < _ref; i = _i += 1) {
            if ((_ref1 = this[i].parentNode) != null) {
              _ref1.replaceChild(clones[i], this[i]);
            }
          }
          return clones;
        },
        attr: function(a, v) {
          switch (v) {
            case void 0:
              return this.select("getAttribute").call(a, v);
            case null:
              return this.select("removeAttribute").call(a, v);
            default:
              this.select("setAttribute").call(a, v);
              return this;
          }
        },
        data: function(k, v) {
          return this.attr("data-" + ($.dashize(k)), v);
        },
        addClass: function(x) {
          var notempty;
          notempty = function(y) {
            return y !== "";
          };
          return this.removeClass(x).each(function() {
            var c;
            c = this.className.split(" ").filter(notempty);
            c.push(x);
            return this.className = c.join(" ");
          });
        },
        removeClass: function(x) {
          var notx;
          notx = function(y) {
            return y !== x;
          };
          return this.each(function() {
            var c;
            c = this.className.split(" ").filter(notx).join(" ");
            if (c.length === 0) {
              return this.removeAttribute('class');
            }
          });
        },
        toggleClass: function(x) {
          var notx;
          notx = function(y) {
            return y !== x;
          };
          return this.each(function() {
            var c, cls, filter;
            cls = this.className.split(" ");
            filter = $.not($.isEmpty);
            if (cls.indexOf(x) > -1) {
              filter = $.and(notx, filter);
            } else {
              cls.push(x);
            }
            c = cls.filter(filter).join(" ");
            this.className = c;
            if (c.length === 0) {
              return this.removeAttribute('class');
            }
          });
        },
        hasClass: function(x) {
          return this.select('className.split').call(" ").select('indexOf').call(x).map(function(x) {
            return x > -1;
          });
        },
        text: function(t) {
          if (t != null) {
            return this.zap('textContent', t);
          }
          return this.select('textContent');
        },
        val: function(v) {
          if (v != null) {
            return this.zap('value', v);
          }
          return this.select('value');
        },
        css: function(key, v) {
          var cv, i, k, n, nn, ov, setters, _i, _ref;
          if ((v != null) || $.is("object", key)) {
            setters = this.select('style.setProperty');
            if ($.is("object", key)) {
              for (k in key) {
                v = key[k];
                setters.call(k, v, "");
              }
            } else if ($.is("array", v)) {
              for (i = _i = 0, _ref = n = Math.max(v.length, nn = setters.length); _i < _ref; i = _i += 1) {
                setters[i % nn](key, v[i % n], "");
              }
            } else {
              setters.call(key, v, "");
            }
            return this;
          } else {
            cv = this.map(computeCSSProperty(key));
            ov = this.select('style').select(key);
            return ov.weave(cv).fold(function(x, y) {
              return x || y;
            });
          }
        },
        defaultCss: function(k, v) {
          var i, sel, style;
          sel = this.selector;
          style = "";
          if ($.is("string", k)) {
            if ($.is("string", v)) {
              style += "" + sel + " { " + k + ": " + v + " } ";
            } else {
              throw Error("defaultCss requires a value with a string key");
            }
          } else if ($.is("object", k)) {
            for (i in k + "} ") {
              style += ("" + sel + " { ") + ("" + i + ": " + k[i] + "; ");
            }
          }
          $("<style></style>").text(style).appendTo("head");
          return this;
        },
        rect: function() {
          return this.map(function(item) {
            switch (item) {
              case window:
                return {
                  width: window.innerWidth,
                  height: window.innerHeight,
                  top: 0,
                  left: 0,
                  right: window.innerWidth,
                  bottom: window.innerHeight
                };
              default:
                return item.getBoundingClientRect();
            }
          });
        },
        width: getOrSetRect("width"),
        height: getOrSetRect("height"),
        top: getOrSetRect("top"),
        left: getOrSetRect("left"),
        bottom: getOrSetRect("bottom"),
        right: getOrSetRect("right"),
        position: function(left, top) {
          switch (true) {
            case !(left != null):
              return this.rect();
            case !(top != null):
              return this.css("left", $.px(left));
            default:
              return this.css({
                top: $.px(top),
                left: $.px(left)
              });
          }
        },
        scrollToCenter: function() {
          document.body.scrollTop = this[0].offsetTop - ($.global.innerHeight / 2);
          return this;
        },
        child: function(n) {
          return this.select('childNodes').map(function() {
            return this[n < 0 ? n + this.length : n];
          });
        },
        parents: selectChain('parentNode'),
        prev: selectChain('previousSibling'),
        next: selectChain('nextSibling'),
        remove: function() {
          return this.each(function() {
            var _ref;
            return (_ref = this.parentNode) != null ? _ref.removeChild(this) : void 0;
          });
        },
        find: function(css) {
          return this.filter("*").map(function() {
            return this.querySelectorAll(css);
          }).flatten();
        },
        clone: function(deep) {
          if (deep == null) {
            deep = true;
          }
          return this.map(function() {
            if ($.is("node", this)) {
              return this.cloneNode(deep);
            }
          });
        },
        toFragment: function() {
          var df;
          if (this.length > 1) {
            df = document.createDocumentFragment();
            (this.map(toNode)).map($.bound(df, df.appendChild));
            return df;
          }
          return toNode(this[0]);
        }
      };
    });
  }

  $.plugin({
    depends: "dom,function,core",
    provides: "event"
  }, function() {
    var EVENTSEP_RE, bindReady, binder, events, register_live, ret, triggerReady, unregister_live;
    EVENTSEP_RE = /,* +/;
    events = ['mousemove', 'mousedown', 'mouseup', 'mouseover', 'mouseout', 'blur', 'focus', 'load', 'unload', 'reset', 'submit', 'keyup', 'keydown', 'change', 'abort', 'cut', 'copy', 'paste', 'selection', 'drag', 'drop', 'orientationchange', 'touchstart', 'touchmove', 'touchend', 'touchcancel', 'gesturestart', 'gestureend', 'gesturecancel', 'hashchange'];
    binder = function(e) {
      return function(f) {
        return this.bind(e, f)($.is("function", f) ? void 0 : this.trigger(e, f));
      };
    };
    register_live = function(selector, context, evt, f, h) {
      return $(context).bind(evt, h).each(function() {
        var _base, _base1;
        return ((_base = ((_base1 = (this.__alive__ || (this.__alive__ = {})))[selector] || (_base1[selector] = {})))[evt] || (_base[evt] = {}))[f] = h;
      });
    };
    unregister_live = function(selector, context, e, f) {
      var $c;
      $c = $(context);
      return $c.each(function() {
        var a, b, c;
        a = (this.__alive__ || (this.__alive__ = {}));
        b = (a[selector] || (a[selector] = {}));
        c = (b[e] || (b[e] = {}));
        $c.unbind(e, c[f]);
        return delete c[f];
      });
    };
    triggerReady = $.once(function() {
      var _base;
      $(document).trigger("ready").unbind("ready");
      if (typeof document.removeEventListener === "function") {
        document.removeEventListener("DOMContentLoaded", triggerReady, false);
      }
      return typeof (_base = $.global).removeEventListener === "function" ? _base.removeEventListener("load", triggerReady, false) : void 0;
    });
    bindReady = $.once(function() {
      var _base;
      if (typeof document.addEventListener === "function") {
        document.addEventListener("DOMContentLoaded", triggerReady, false);
      }
      return typeof (_base = $.global).addEventListener === "function" ? _base.addEventListener("load", triggerReady, false) : void 0;
    });
    bindReady();
    ret = {
      bind: function(e, f) {
        var c, h;
        c = (e || "").split(EVENTSEP_RE);
        h = function(evt) {
          ret = f.apply(this, arguments);
          if (ret === false) {
            evt.preventAll();
          }
          return ret;
        };
        return this.each(function() {
          var i, _i, _len, _results;
          _results = [];
          for (_i = 0, _len = c.length; _i < _len; _i++) {
            i = c[_i];
            _results.push(this.addEventListener(i, h, false));
          }
          return _results;
        });
      },
      unbind: function(e, f) {
        var c;
        c = (e || "").split(EVENTSEP_RE);
        return this.each(function() {
          var i, _i, _len, _results;
          _results = [];
          for (_i = 0, _len = c.length; _i < _len; _i++) {
            i = c[_i];
            _results.push(this.removeEventListener(i, f, null));
          }
          return _results;
        });
      },
      trigger: function(evt, args) {
        var e, evt_i, _i, _len, _ref;
        if (args == null) {
          args = {};
        }
        args = $.extend({
          bubbles: true,
          cancelable: true
        }, args);
        _ref = (evt || "").split(EVENTSEP_RE);
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          evt_i = _ref[_i];
          if (evt_i === "click" || evt_i === "mousemove" || evt_i === "mousedown" || evt_i === "mouseup" || evt_i === "mouseover" || evt_i === "mouseout") {
            e = document.createEvent("MouseEvents");
            args = $.extend({
              detail: 1,
              screenX: 0,
              screenY: 0,
              clientX: 0,
              clientY: 0,
              ctrlKey: false,
              altKey: false,
              shiftKey: false,
              metaKey: false,
              button: 0,
              relatedTarget: null
            }, args);
            e.initMouseEvent(evt_i, args.bubbles, args.cancelable, $.global, args.detail, args.screenX, args.screenY, args.clientX, args.clientY, args.ctrlKey, args.altKey, args.shiftKey, args.metaKey, args.button, args.relatedTarget);
          } else if (evt_i === "blur" || evt_i === "focus" || evt_i === "reset" || evt_i === "submit" || evt_i === "abort" || evt_i === "change" || evt_i === "load" || evt_i === "unload") {
            e = document.createEvent("UIEvents");
            e.initUIEvent(evt_i, args.bubbles, args.cancelable, $.global, 1);
          } else if (evt_i === "touchstart" || evt_i === "touchmove" || evt_i === "touchend" || evt_i === "touchcancel") {
            e = document.createEvent("TouchEvents");
            args = $.extend({
              detail: 1,
              screenX: 0,
              screenY: 0,
              clientX: 0,
              clientY: 0,
              ctrlKey: false,
              altKey: false,
              shiftKey: false,
              metaKey: false,
              touches: [],
              targetTouches: [],
              changedTouches: [],
              scale: 1.0,
              rotation: 0.0
            }, args);
            e.initTouchEvent(evt_i, args.bubbles, args.cancelable, $.global, args.detail, args.screenX, args.screenY, args.clientX, args.clientY, args.ctrlKey, args.altKey, args.shiftKey, args.metaKey, args.touches, args.targetTouches, args.changedTouches, args.scale, args.rotation);
          } else if (evt_i === "gesturestart" || evt_i === "gestureend" || evt_i === "gesturecancel") {
            e = document.createEvent("GestureEvents");
            args = $.extend({
              detail: 1,
              screenX: 0,
              screenY: 0,
              clientX: 0,
              clientY: 0,
              ctrlKey: false,
              altKey: false,
              shiftKey: false,
              metaKey: false,
              target: null,
              scale: 1.0,
              rotation: 0.0
            }, args);
            e.initGestureEvent(evt_i, args.bubbles, args.cancelable, $.global, args.detail, args.screenX, args.screenY, args.clientX, args.clientY, args.ctrlKey, args.altKey, args.shiftKey, args.metaKey, args.target, args.scale, args.rotation);
          } else {
            e = document.createEvent("Events");
            e.initEvent(evt_i, args.bubbles, args.cancelable);
            try {
              e = $.extend(e, args);
            } catch (err) {
              $.log("Error in dispatch: ", err);
            }
          }
          if (!e) {
            continue;
          } else {
            try {
              this.each(function() {
                return this.dispatchEvent(e);
              });
            } catch (err) {
              $.log("dispatchEvent error:", err);
            }
          }
        }
        return this;
      },
      delegate: function(selector, e, f) {
        var context;
        context = this;
        return register_live(selector, context, e, f, function(evt) {
          return context.find(selector).intersect($(evt.target).parents().first().union($(evt.target))).each(function() {
            return f.call(evt.target = this, evt);
          });
        });
      },
      undelegate: function(selector, e, f) {
        return this.unbind(e, unregister_live(selector, this, e, f));
      },
      click: function(f) {
        var _ref;
        if (f == null) {
          f = {};
        }
        if ((_ref = this.css("cursor")) === "auto" || _ref === "") {
          this.css("cursor", "pointer");
        }
        if ($.is("function", f)) {
          this.bind('click', f);
        } else {
          this.trigger('click', f);
        }
        return this;
      },
      ready: function(f) {
        if (triggerReady.exhausted) {
          return f.call(this);
        }
        return this.bind("ready", f);
      }
    };
    events.forEach(function(x) {
      return ret[x] = binder(x);
    });
    return ret;
  });

  $.plugin({
    provides: "function",
    depends: "hash"
  }, function() {
    return {
      $: {
        identity: function(o) {
          return o;
        },
        not: function(f) {
          return function() {
            return !f.apply(this, arguments);
          };
        },
        compose: function(f, g) {
          return function(x) {
            var y;
            return f.call(y, (y = g.call(x, x)));
          };
        },
        and: function(f, g) {
          return function(x) {
            return g.call(this, x) && f.call(this, x);
          };
        },
        once: function(f, n) {
          if (n == null) {
            n = 1;
          }
          return $.defineProperty((function() {
            if (n-- > 0) {
              return f.apply(this, arguments);
            }
          }), "exhausted", {
            get: function() {
              return n <= 0;
            }
          });
        },
        cycle: function() {
          var f, i;
          f = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
          i = -1;
          return function() {
            return f[i = ++i % f.length].apply(this, arguments);
          };
        },
        bound: function(t, f, args) {
          var r;
          if (args == null) {
            args = [];
          }
          if ($.is("function", f.bind)) {
            args.splice(0, 0, t);
            r = f.bind.apply(f, args);
          } else {
            r = function() {
              var a;
              a = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
              return f.apply(t, args(args.length ? void 0 : a));
            };
          }
          return $.extend(r, {
            toString: function() {
              return "bound-method of " + t + "." + f.name;
            }
          });
        },
        E: function(callback) {
          return function(f) {
            return function(err, data) {
              if (!err) {
                return f(data);
              }
              return callback(err, data);
            };
          };
        }
      }
    };
  });

  $.plugin({
    provides: "groupBy"
  }, function() {
    return {
      groupBy: function(key) {
        var groups;
        groups = {};
        switch ($.type(key)) {
          case 'array':
          case 'bling':
            this.each(function() {
              var c, k;
              c = ((function() {
                var _i, _len, _results;
                _results = [];
                for (_i = 0, _len = key.length; _i < _len; _i++) {
                  k = key[_i];
                  _results.push(this[k]);
                }
                return _results;
              }).call(this)).join(",");
              return (groups[c] || (groups[c] = $())).push(this);
            });
            break;
          default:
            this.each(function() {
              var _name;
              return (groups[_name = this[key]] || (groups[_name] = $())).push(this);
            });
        }
        return $.valuesOf(groups);
      }
    };
  });

  $.plugin({
    provides: "hash",
    depends: "type"
  }, function() {
    $.type.extend({
      unknown: {
        hash: function(o) {
          return $.checksum($.toString(o));
        }
      },
      object: {
        hash: function(o) {
          var k, v;
          return $.hash(Object) + $((function() {
            var _results;
            _results = [];
            for (k in o) {
              v = o[k];
              _results.push($.hash(k) + $.hash(v));
            }
            return _results;
          })()).sum();
        }
      },
      array: {
        hash: function(o) {
          return $.hash(Array) + $(o.map($.hash)).reduce(function(a, x) {
            return (a * a) + (x | 0);
          }, 1);
        }
      },
      bool: {
        hash: function(o) {
          return parseInt(o ? 1 : void 0);
        }
      }
    });
    return {
      $: {
        hash: function(x) {
          return $.type.lookup(x).hash(x);
        }
      },
      hash: function() {
        return $.hash(this);
      }
    };
  });

  $.plugin(function() {
    return {
      $: {
        histogram: function(data, bucket_width, output_width) {
          var buckets, end, i, len, m, max, mean, min, n, pct, pct_sum, ret, sum, total, x, _i, _j, _len;
          if (bucket_width == null) {
            bucket_width = 1;
          }
          if (output_width == null) {
            output_width = 60;
          }
          buckets = $();
          len = 0;
          min = Infinity;
          mean = 0;
          max = 0;
          total = 0;
          for (_i = 0, _len = data.length; _i < _len; _i++) {
            x = data[_i];
            min = Math.min(x, min);
            max = Math.max(x, max);
            total += x;
            i = Math.floor(x / bucket_width);
            if (i in buckets) {
              buckets[i] += 1;
            } else {
              buckets[i] = 1;
            }
            len = Math.max(len, i + 1);
          }
          buckets.length = len;
          mean = total / data.length;
          m = buckets.max();
          buckets = buckets.or(0).scale(1 / m).scale(output_width);
          sum = buckets.sum();
          ret = "";
          pct_sum = 0;
          for (n = _j = 0; _j < len; n = _j += 1) {
            end = (n + 1) * bucket_width;
            pct = buckets[n] * 100 / sum;
            pct_sum += pct;
            ret += $.padLeft(pct_sum.toFixed(2) + "%", 7) + $.padRight(" < " + (end.toFixed(2)), 10) + ": " + $.repeat("#", buckets[n]) + "\n";
          }
          return ret + ("N: " + data.length + " Min: " + (min.toFixed(2)) + " Max: " + (max.toFixed(2)) + " Mean: " + (mean.toFixed(2)));
        }
      },
      histogram: function() {
        return $.histogram(this);
      }
    };
  });

  $.plugin({
    provides: "hook",
    depends: "type"
  }, function() {
    var hook, hooks;
    hooks = {};
    hook = function(name, args) {
      var func, p, _i, _len;
      p = (hooks[name] || (hooks[name] = []));
      if (!args) {
        return {
          prepend: function(obj) {
            p.unshift(obj);
            return obj;
          },
          append: function(obj) {
            p.push(obj);
            return obj;
          }
        };
      }
      for (_i = 0, _len = p.length; _i < _len; _i++) {
        func = p[_i];
        args = func.call(this, args);
      }
      return args;
    };
    hook("bling-init").prepend(function(args) {
      var b, i;
      if (args.length === 1) {
        args = $.type.lookup(args[0]).array(args[0]);
      }
      b = $.inherit(Bling, args);
      if (args.length === 0 && args[0] !== void 0) {
        i = 0;
        while (args[i] !== void 0) {
          i++;
        }
        b.length = i;
      }
      return b;
    });
    return {
      $: {
        hook: hook
      }
    };
  });

  $.plugin({
    depends: "dom",
    provides: "http"
  }, function() {
    var formencode;
    formencode = function(obj) {
      var i, o;
      o = JSON.parse(JSON.stringify(obj));
      return ((function() {
        var _results;
        _results = [];
        for (i in o) {
          _results.push("" + i + "=" + (escape(o[i])));
        }
        return _results;
      })()).join("&");
    };
    $.type.register("http", {
      match: function(o) {
        return $.isType('XMLHttpRequest', o);
      },
      array: function(o) {
        return [o];
      }
    });
    return {
      $: {
        http: function(url, opts) {
          var xhr;
          if (opts == null) {
            opts = {};
          }
          xhr = new XMLHttpRequest();
          if ($.is("function", opts)) {
            opts = {
              success: $.bound(xhr, opts)
            };
          }
          opts = $.extend({
            method: "GET",
            data: null,
            state: $.identity,
            success: $.identity,
            error: $.identity,
            async: true,
            asBlob: false,
            timeout: 0,
            followRedirects: false,
            withCredentials: false
          }, opts);
          opts.state = $.bound(xhr, opts.state);
          opts.success = $.bound(xhr, opts.success);
          opts.error = $.bound(xhr, opts.error);
          if (opts.data && opts.method === "GET") {
            url += "?" + formencode(opts.data);
          } else if (opts.data && opts.method === "POST") {
            opts.data = formencode(opts.data);
          }
          xhr.open(opts.method, url, opts.async);
          xhr = $.extend(xhr, {
            asBlob: opts.asBlob,
            timeout: opts.timeout,
            followRedirects: opts.followRedirects,
            withCredentials: opts.withCredentials,
            onreadystatechange: function() {
              if (typeof opts.state === "function") {
                opts.state();
              }
              if (xhr.readyState === 4) {
                if (xhr.status === 200) {
                  return opts.success(xhr.responseText);
                } else {
                  return opts.error(xhr.status, xhr.statusText);
                }
              }
            }
          });
          xhr.send(opts.data);
          return $(xhr);
        },
        post: function(url, opts) {
          if (opts == null) {
            opts = {};
          }
          if ($.is("function", opts)) {
            opts = {
              success: opts
            };
          }
          opts.method = "POST";
          return $.http(url, opts);
        },
        get: function(url, opts) {
          if (opts == null) {
            opts = {};
          }
          if ($.is("function", opts)) {
            opts = {
              success: opts
            };
          }
          opts.method = "GET";
          return $.http(url, opts);
        }
      }
    };
  });

  $.depends('hook', function() {
    return $.hook('bling-init').append(function(obj) {
      var keyMakers, map;
      map = Object.create(null);
      keyMakers = [];
      return $.inherit({
        index: function(keyFunc) {
          if (keyMakers.indexOf(keyFunc) === -1) {
            keyMakers.push(keyFunc);
            map[keyFunc] = Object.create(null);
          }
          return this.each(function(x) {
            return map[keyFunc][keyFunc(x)] = x;
          });
        },
        query: function(criteria) {
          var key, keyMaker, _i, _len;
          for (_i = 0, _len = keyMakers.length; _i < _len; _i++) {
            keyMaker = keyMakers[_i];
            key = keyMaker(criteria);
            if (key in map[keyMaker]) {
              return map[keyMaker][key];
            }
          }
          return null;
        }
      }, obj);
    });
  });

  $.plugin({
    depends: "dom",
    provides: "lazy"
  }, function() {
    var lazy_load;
    lazy_load = function(elementName, props) {
      return $("head").append($.extend(document.createElement(elementName), props));
    };
    return {
      $: {
        script: function(src) {
          return lazy_load("script", {
            src: src
          });
        },
        style: function(src) {
          return lazy_load("link", {
            href: src,
            rel: "stylesheet"
          });
        }
      }
    };
  });

  $.plugin({
    provides: "math",
    depends: "core"
  }, function() {
    var add, mean, sub, _By;
    $.type.extend({
      bool: {
        number: function(o) {
          if (o) {
            return 1;
          } else {
            return 0;
          }
        }
      },
      number: {
        bool: function(o) {
          return !!o;
        }
      }
    });
    _By = function(cmp) {
      return function(field) {
        var valueOf, x;
        valueOf = (function() {
          switch ($.type(field)) {
            case "string":
              return function(o) {
                return o[field];
              };
            case "function":
              return field;
            default:
              throw new Error(".maxBy first argument should be a string or function");
          }
        })();
        x = this.first();
        this.skip(1).each(function() {
          if (cmp(valueOf(this), valueOf(x))) {
            return x = this;
          }
        });
        return x;
      };
    };
    return {
      $: {
        range: function(start, end, step) {
          var i;
          if (step == null) {
            step = 1;
          }
          if (!(end != null)) {
            end = start;
            start = 0;
          }
          if (end < start && step > 0) {
            step *= -1;
          }
          return $((function() {
            var _i, _ref, _results;
            _results = [];
            for (i = _i = 0, _ref = Math.ceil((end - start) / step); 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
              _results.push(start + (i * step));
            }
            return _results;
          })());
        },
        zeros: function(n) {
          var i;
          return $((function() {
            var _i, _results;
            _results = [];
            for (i = _i = 0; 0 <= n ? _i < n : _i > n; i = 0 <= n ? ++_i : --_i) {
              _results.push(0);
            }
            return _results;
          })());
        },
        ones: function(n) {
          var i;
          return $((function() {
            var _i, _results;
            _results = [];
            for (i = _i = 0; 0 <= n ? _i < n : _i > n; i = 0 <= n ? ++_i : --_i) {
              _results.push(1);
            }
            return _results;
          })());
        },
        deg2rad: function(n) {
          return n * Math.PI / 180;
        },
        rad2deg: function(n) {
          return n * 180 / Math.PI;
        }
      },
      floats: function() {
        return this.map(parseFloat);
      },
      ints: function() {
        return this.map(function() {
          return parseInt(this, 10);
        });
      },
      px: function(delta) {
        return this.ints().map(function() {
          return $.px(this, delta);
        });
      },
      min: function() {
        return this.filter(isFinite).reduce(Math.min);
      },
      max: function() {
        return this.filter(isFinite).reduce(Math.max);
      },
      maxBy: _By(function(a, b) {
        return a > b;
      }),
      minBy: _By(function(a, b) {
        return a < b;
      }),
      mean: mean = function() {
        if (!this.length) {
          return 0;
        } else {
          return this.sum() / this.length;
        }
      },
      avg: mean,
      sum: function() {
        return this.filter(isFinite).reduce((function(a) {
          return a + this;
        }), 0);
      },
      product: function() {
        return this.filter(isFinite).reduce(function(a) {
          return a * this;
        });
      },
      squares: function() {
        return this.pow(2);
      },
      pow: function(n) {
        return this.map(function() {
          return Math.pow(this, n);
        });
      },
      magnitude: function() {
        return Math.sqrt(this.floats().squares().sum());
      },
      scale: function(r) {
        return this.map(function() {
          return r * this;
        });
      },
      add: add = function(d) {
        var i;
        switch ($.type(d)) {
          case "number":
            return this.map(function() {
              return d + this;
            });
          case "bling":
          case "array":
            return $((function() {
              var _i, _ref, _results;
              _results = [];
              for (i = _i = 0, _ref = Math.min(this.length, d.length); 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
                _results.push(this[i] + d[i]);
              }
              return _results;
            }).call(this));
        }
      },
      plus: add,
      sub: sub = function(d) {
        var i;
        switch ($.type(d)) {
          case "number":
            return this.map(function() {
              return this - d;
            });
          case "bling":
          case "array":
            return $((function() {
              var _i, _ref, _results;
              _results = [];
              for (i = _i = 0, _ref = Math.min(this.length, d.length); 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
                _results.push(this[i] - d[i]);
              }
              return _results;
            }).call(this));
        }
      },
      minus: sub,
      dot: function(b) {
        var i;
        return $.sum((function() {
          var _i, _ref, _results;
          _results = [];
          for (i = _i = 0, _ref = Math.min(this.length, b.length); 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
            _results.push(this[i] * b[i]);
          }
          return _results;
        }).call(this));
      },
      angle: function(b) {
        return Math.acos(this.dot(b) / (this.magnitude() * b.magnitude()));
      },
      cross: function(b) {
        return $(this[1] * b[2] - this[2] * b[1], this[2] * b[0] - this[0] * b[2], this[0] * b[1] - this[1] * b[0]);
      },
      normalize: function() {
        return this.scale(1 / this.magnitude());
      },
      deg2rad: function() {
        return this.filter(isFinite).map(function() {
          return this * Math.PI / 180;
        });
      },
      rad2deg: function() {
        return this.filter(isFinite).map(function() {
          return this * 180 / Math.PI;
        });
      }
    };
  });

  $.plugin({
    depends: 'function',
    provides: 'memoize'
  }, function() {
    return {
      $: {
        memoize: function(opts) {
          if ($.is('function', opts)) {
            opts = {
              f: opts
            };
          }
          if (!$.is('object', opts)) {
            throw new Error("Argument Error: memoize requires either a function or object as first argument");
          }
          opts.cache || (opts.cache = Object.create(null));
          opts.hash || (opts.hash = $.identity);
          return function() {
            var _base, _name, _ref;
            return (_ref = (_base = opts.cache)[_name = opts.hash(arguments)]) != null ? _ref : _base[_name] = opts.f.apply(this, arguments);
          };
        }
      }
    };
  });

  $.plugin({
    depends: "core",
    provides: "pubsub"
  }, function() {
    var Hub;
    Hub = (function() {

      function Hub() {
        this.listeners = {};
      }

      Hub.prototype.publish = function() {
        var args, channel, f, _base, _i, _len, _ref;
        channel = arguments[0], args = 2 <= arguments.length ? __slice.call(arguments, 1) : [];
        _ref = ((_base = this.listeners)[channel] || (_base[channel] = []));
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          f = _ref[_i];
          f.apply(null, args);
        }
        return args;
      };

      Hub.prototype.publisher = function(channel, func) {
        var t;
        t = this;
        return function() {
          return t.publish(channel, func.apply(this, arguments));
        };
      };

      Hub.prototype.subscribe = function(channel, func) {
        var _base;
        ((_base = this.listeners)[channel] || (_base[channel] = [])).push(func);
        return func;
      };

      Hub.prototype.unsubscribe = function(channel, func) {
        var a, i, _base;
        if (!(func != null)) {
          return this.listeners[channel] = [];
        } else {
          a = ((_base = this.listeners)[channel] || (_base[channel] = []));
          if ((i = a.indexOf(func)) > -1) {
            return a.splice(i, i);
          }
        }
      };

      return Hub;

    })();
    return {
      $: $.extend(new Hub(), {
        Hub: Hub
      })
    };
  });

  $.plugin({
    provides: 'random',
    depends: 'type'
  }, function() {
    var alphabet;
    alphabet = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");
    return {
      $: {
        random: (function() {
          var MT, a, b, coin, dice, die, gaussian, generate_numbers, index, init_generator, integer, next, real, string;
          MT = new Array(624);
          index = 0;
          init_generator = function(seed) {
            var i, _i, _results;
            index = 0;
            MT[0] = seed;
            _results = [];
            for (i = _i = 1; _i <= 623; i = ++_i) {
              _results.push(MT[i] = 0xFFFFFFFF & (1812433253 * (MT[i - 1] ^ (MT[i - 1] >>> 30)) + i));
            }
            return _results;
          };
          generate_numbers = function() {
            var i, y, _i, _results;
            _results = [];
            for (i = _i = 0; _i <= 623; i = ++_i) {
              y = ((MT[i] & 0x80000000) >>> 31) + (0x7FFFFFFF & MT[(i + 1) % 624]);
              MT[i] = MT[(i + 397) % 624] ^ (y >>> 1);
              if ((y % 2) === 1) {
                _results.push(MT[i] = MT[i] ^ 2567483615);
              } else {
                _results.push(void 0);
              }
            }
            return _results;
          };
          a = Math.pow(2, 31);
          b = a * 2;
          next = function() {
            var y;
            if (index === 0) {
              generate_numbers();
            }
            y = MT[index] ^ (y >>> 11) ^ ((y << 7) && 2636928640) ^ ((y << 15) && 4022730752) ^ (y >>> 18);
            index = (index + 1) % 624;
            return (y + a) / b;
          };
          $.defineProperty(next, "seed", {
            set: function(v) {
              return init_generator(v);
            }
          });
          next.seed = +new Date();
          return $.extend(next, {
            real: real = function(min, max) {
              var _ref, _ref1;
              if (!(min != null)) {
                _ref = [0, 1.0], min = _ref[0], max = _ref[1];
              }
              if (!(max != null)) {
                _ref1 = [0, min], min = _ref1[0], max = _ref1[1];
              }
              return ($.random() * (max - min)) + min;
            },
            integer: integer = function(min, max) {
              return Math.floor($.random.real(min, max));
            },
            string: string = function(len, prefix) {
              if (prefix == null) {
                prefix = "";
              }
              while (prefix.length < len) {
                prefix += $.random.element(alphabet);
              }
              return prefix;
            },
            coin: coin = function(balance) {
              if (balance == null) {
                balance = .5;
              }
              return $.random() <= balance;
            },
            element: function(arr, weights) {
              var i, item, r, sorted, sum, w, _i, _len;
              if (weights != null) {
                w = $(weights);
                w = w.scale(1.0 / w.sum());
                i = 0;
                sorted = $(arr).map(function(x) {
                  return {
                    v: x,
                    w: w[i++]
                  };
                }).sortBy(function(x) {
                  return -x.w;
                });
                r = $.random.real(0.00001, .999999);
                sum = 0;
                for (_i = 0, _len = sorted.length; _i < _len; _i++) {
                  item = sorted[_i];
                  if ((sum += item.w) >= r) {
                    return item.v;
                  }
                }
              }
              return arr[$.random.integer(0, arr.length)];
            },
            gaussian: gaussian = function(mean, ssig) {
              var q, u, v, x, y;
              if (mean == null) {
                mean = 0.5;
              }
              if (ssig == null) {
                ssig = 0.12;
              }
              while (true) {
                u = $.random();
                v = 1.7156 * ($.random() - 0.5);
                x = u - 0.449871;
                y = Math.abs(v) + 0.386595;
                q = (x * x) + y * (0.19600 * y - 0.25472 * x);
                if (!(q > 0.27597 && (q > 0.27846 || (v * v) > (-4 * Math.log(u) * u * u)))) {
                  break;
                }
              }
              return mean + ssig * v / u;
            },
            dice: dice = function(n, faces) {
              var _;
              return $((function() {
                var _i, _results;
                _results = [];
                for (_ = _i = 0; _i < n; _ = _i += 1) {
                  _results.push(die(faces));
                }
                return _results;
              })());
            },
            die: die = function(faces) {
              return $.random.integer(1, faces + 1);
            }
          });
        })()
      }
    };
  });

  $.plugin({
    provides: "sendgrid",
    depends: "config"
  }, function() {
    var closeTransport, nodemailer, openTransport, transport;
    try {
      nodemailer = require('nodemailer');
    } catch (err) {
      return;

    }
    transport = null;
    openTransport = function() {
      return transport || (transport = nodemailer.createTransport('SMTP', {
        service: 'SendGrid',
        auth: {
          user: $.config.get('SENDGRID_USERNAME'),
          pass: $.config.get('SENDGRID_PASSWORD')
        }
      }));
    };
    closeTransport = function() {
      if (transport != null) {
        transport.close();
      }
      return transport = null;
    };
    return {
      $: {
        sendMail: function(mail, callback) {
          var _ref, _ref1, _ref2;
          if ((_ref = mail.transport) == null) {
            mail.transport = openTransport();
          }
          if ((_ref1 = mail.from) == null) {
            mail.from = $.config.get('EMAILS_FROM');
          }
          if ((_ref2 = mail.bcc) == null) {
            mail.bcc = $.config.get('EMAILS_BCC');
          }
          if ($.config.get('SENDGRID_ENABLED', 'true') === 'true') {
            return nodemailer.sendMail(mail, function(err) {
              if (mail.close) {
                closeTransport();
              }
              return callback(err);
            });
          } else {
            if (mail.close) {
              closeTransport();
            }
            return callback(false);
          }
        }
      }
    };
  });

  $.plugin({
    provides: "sortBy,sortedIndex"
  }, function() {
    return {
      $: {
        sortedIndex: function(array, item, iterator) {
          var cmp, hi, lo, mid;
          cmp = (function() {
            switch ($.type(iterator)) {
              case "string":
                return function(a, b) {
                  return a[iterator] - b[iterator];
                };
              case "function":
                return function(a, b) {
                  return iterator(a) - iterator(b);
                };
              default:
                return function(a, b) {
                  return a - b;
                };
            }
          })();
          hi = array.length;
          lo = 0;
          while (lo < hi) {
            mid = (hi + lo) >>> 1;
            if (cmp(array[mid], item) < 0) {
              lo = mid + 1;
            } else {
              hi = mid;
            }
          }
          return lo;
        }
      },
      sortBy: function(iterator) {
        var a, item, n, _i, _len;
        a = $();
        for (_i = 0, _len = this.length; _i < _len; _i++) {
          item = this[_i];
          n = $.sortedIndex(a, item, iterator);
          a.splice(n, 0, item);
        }
        return a;
      },
      sortedInsert: function(item, iterator) {
        this.splice($.sortedIndex(this, item, iterator), 0, item);
        return this;
      }
    };
  });

  $.plugin({
    provides: "string",
    depends: "function"
  }, function() {
    var safer;
    safer = function(f) {
      return function() {
        var a;
        a = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
        try {
          return f.apply(null, a);
        } catch (err) {
          return "[Error: " + err.message + "]";
        }
      };
    };
    $.type.extend({
      unknown: {
        string: safer(function(o) {
          var _ref;
          return (_ref = typeof o.toString === "function" ? o.toString() : void 0) != null ? _ref : String(o);
        }),
        repr: safer(function(o) {
          return $.type.lookup(o).string(o);
        }),
        number: safer(function(o) {
          return parseFloat(String(o));
        })
      },
      "null": {
        string: function() {
          return "null";
        }
      },
      undefined: {
        string: function() {
          return "undefined";
        }
      },
      string: {
        number: safer(parseFloat),
        repr: function(s) {
          return "'" + s + "'";
        }
      },
      array: {
        string: safer(function(a) {
          var x;
          return "[" + ((function() {
            var _i, _len, _results;
            _results = [];
            for (_i = 0, _len = a.length; _i < _len; _i++) {
              x = a[_i];
              _results.push($.toString(x));
            }
            return _results;
          })()).join(",") + "]";
        })
      },
      object: {
        string: safer(function(o) {
          var k, ret, v;
          ret = [];
          for (k in o) {
            try {
              v = o[k];
            } catch (err) {
              v = "[Error: " + err.message + "]";
            }
            ret.push("" + k + ":" + ($.toString(v)));
          }
          return "{" + ret.join(', ') + "}";
        })
      },
      "function": {
        string: function(f) {
          return f.toString().replace(/^([^{]*){(?:.|\n|\r)*}$/, '$1{ ... }');
        }
      },
      number: {
        repr: function(n) {
          return String(n);
        },
        string: safer(function(n) {
          switch (true) {
            case n.precision != null:
              return n.toPrecision(n.precision);
            case n.fixed != null:
              return n.toFixed(n.fixed);
            default:
              return String(n);
          }
        })
      }
    });
    return {
      $: {
        toString: function(x) {
          if (!(x != null)) {
            return "function Bling(selector, context) { [ ... ] }";
          } else {
            try {
              return $.type.lookup(x).string(x);
            } catch (err) {
              return "[Error: " + err.message + "]";
            }
          }
        },
        toRepr: function(x) {
          return $.type.lookup(x).repr(x);
        },
        px: function(x, delta) {
          if (delta == null) {
            delta = 0;
          }
          return (x != null) && (parseInt(x, 10) + (delta | 0)) + "px";
        },
        capitalize: function(name) {
          return (name.split(" ").map(function(x) {
            return x[0].toUpperCase() + x.substring(1).toLowerCase();
          })).join(" ");
        },
        dashize: function(name) {
          var c, i, ret, _i, _ref;
          ret = "";
          for (i = _i = 0, _ref = (name != null ? name.length : void 0) | 0; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
            c = name.charCodeAt(i);
            if ((91 > c && c > 64)) {
              c += 32;
              ret += '-';
            }
            ret += String.fromCharCode(c);
          }
          return ret;
        },
        camelize: function(name) {
          var i;
          name.split('-');
          while ((i = name != null ? name.indexOf('-') : void 0) > -1) {
            name = $.stringSplice(name, i, i + 2, name[i + 1].toUpperCase());
          }
          return name;
        },
        padLeft: function(s, n, c) {
          if (c == null) {
            c = " ";
          }
          while (s.length < n) {
            s = c + s;
          }
          return s;
        },
        padRight: function(s, n, c) {
          if (c == null) {
            c = " ";
          }
          while (s.length < n) {
            s = s + c;
          }
          return s;
        },
        stringTruncate: function(s, n, c) {
          var r, x;
          if (c == null) {
            c = "...";
          }
          s = s.split(' ');
          r = [];
          while (n > 0) {
            x = s.shift();
            n -= x.length;
            if (n >= 0) {
              r.push(x);
            }
          }
          return r.join('') + c;
        },
        stringCount: function(s, x, i, n) {
          var j;
          if (i == null) {
            i = 0;
          }
          if (n == null) {
            n = 0;
          }
          if ((j = s.indexOf(x, i)) > i - 1) {
            return $.stringCount(s, x, j + 1, n + 1);
          } else {
            return n;
          }
        },
        stringSplice: function(s, i, j, n) {
          var end, nn, start;
          nn = s.length;
          end = j;
          if (end < 0) {
            end += nn;
          }
          start = i;
          if (start < 0) {
            start += nn;
          }
          return s.substring(0, start) + n + s.substring(end);
        },
        checksum: function(s) {
          var a, b, i, _i, _ref;
          a = 1;
          b = 0;
          for (i = _i = 0, _ref = s.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
            a = (a + s.charCodeAt(i)) % 65521;
            b = (b + a) % 65521;
          }
          return (b << 16) | a;
        },
        repeat: function(x, n) {
          if (n == null) {
            n = 2;
          }
          switch (true) {
            case n === 1:
              return x;
            case n < 1:
              return "";
            case $.is("string", x):
              return $.zeros(n).map(function() {
                return x;
              }).join('');
            default:
              return $.zeros(n).map(function() {
                return x;
              });
          }
        },
        stringBuilder: function() {
          var items,
            _this = this;
          if ($.is("global", this)) {
            return new $.stringBuilder();
          }
          items = [];
          this.length = 0;
          this.append = function(s) {
            items.push(s);
            return _this.length += (s != null ? s.toString().length : void 0) | 0;
          };
          this.prepend = function(s) {
            items.splice(0, 0, s);
            return _this.length += (s != null ? s.toString().length : void 0) | 0;
          };
          this.clear = function() {
            var ret;
            ret = _this.toString();
            items = [];
            _this.length = 0;
            return ret;
          };
          this.toString = function() {
            return items.join("");
          };
          return this;
        }
      },
      toString: function() {
        return $.toString(this);
      },
      toRepr: function() {
        return $.toRepr(this);
      }
    };
  });

  $.plugin({
    provides: "symbol",
    depends: "type"
  }, function() {
    var cache, g, symbol;
    symbol = null;
    cache = {};
    g = $.global;
    g.Bling = Bling;
    if (typeof module !== "undefined" && module !== null) {
      module.exports = Bling;
    }
    $.defineProperty($, "symbol", {
      set: function(v) {
        g[symbol] = cache[symbol];
        cache[symbol = v] = g[v];
        return g[v] = Bling;
      },
      get: function() {
        return symbol;
      }
    });
    return {
      $: {
        symbol: "$",
        noConflict: function() {
          Bling.symbol = "Bling";
          return Bling;
        }
      }
    };
  });

  $.plugin({
    provides: "StateMachine"
  }, function() {
    var StateMachine;
    return {
      $: {
        StateMachine: StateMachine = (function() {

          function StateMachine(stateTable) {
            this.debug = false;
            this.reset();
            this.table = stateTable;
            Object.defineProperty(this, "modeline", {
              get: function() {
                return this.table[this._mode];
              }
            });
            Object.defineProperty(this, "mode", {
              set: function(m) {
                var ret;
                this._lastMode = this._mode;
                this._mode = m;
                if (this._mode !== this._lastMode && (this.modeline != null) && 'enter' in this.modeline) {
                  ret = this.modeline['enter'].call(this);
                  while ($.is("function", ret)) {
                    ret = ret.call(this);
                  }
                }
                return m;
              },
              get: function() {
                return this._mode;
              }
            });
          }

          StateMachine.prototype.reset = function() {
            this._mode = null;
            return this._lastMode = null;
          };

          StateMachine.prototype.GO = function(m) {
            return function() {
              return this.mode = m;
            };
          };

          StateMachine.GO = function(m) {
            return function() {
              return this.mode = m;
            };
          };

          StateMachine.prototype.tick = function(c) {
            var ret, row;
            row = this.modeline;
            if (!(row != null)) {
              ret = null;
            } else if (c in row) {
              ret = row[c];
            } else if ('def' in row) {
              ret = row['def'];
            }
            while ($.is("function", ret)) {
              ret = ret.call(this, c);
            }
            return ret;
          };

          StateMachine.prototype.run = function(inputs) {
            var c, ret, _i, _len, _ref;
            this.mode = 0;
            for (_i = 0, _len = inputs.length; _i < _len; _i++) {
              c = inputs[_i];
              ret = this.tick(c);
            }
            if ($.is("function", (_ref = this.modeline) != null ? _ref.eof : void 0)) {
              ret = this.modeline.eof.call(this);
            }
            while ($.is("function", ret)) {
              ret = ret.call(this);
            }
            this.reset();
            return this;
          };

          return StateMachine;

        })()
      }
    };
  });

  $.plugin({
    provides: "synth",
    depends: "StateMachine, type"
  }, function() {
    var SynthMachine;
    SynthMachine = (function(_super) {
      var basic;

      __extends(SynthMachine, _super);

      basic = {
        "#": SynthMachine.GO(2),
        ".": SynthMachine.GO(3),
        "[": SynthMachine.GO(4),
        '"': SynthMachine.GO(6),
        "'": SynthMachine.GO(7),
        " ": SynthMachine.GO(8),
        ",": SynthMachine.GO(10),
        "+": SynthMachine.GO(11),
        eof: SynthMachine.GO(13)
      };

      SynthMachine.STATE_TABLE = [
        {
          enter: function() {
            this.tag = this.id = this.cls = this.attr = this.val = this.text = "";
            this.attrs = {};
            return this.GO(1);
          }
        }, $.extend({
          def: function(c) {
            return this.tag += c;
          }
        }, basic), $.extend({
          def: function(c) {
            return this.id += c;
          }
        }, basic), $.extend({
          enter: function() {
            if (this.cls.length > 0) {
              return this.cls += " ";
            }
          },
          def: function(c) {
            return this.cls += c;
          }
        }, basic), {
          "=": SynthMachine.GO(5),
          "]": function() {
            this.attrs[this.attr] = this.val;
            this.attr = this.val = "";
            return this.GO(1);
          },
          def: function(c) {
            return this.attr += c;
          },
          eof: SynthMachine.GO(12)
        }, {
          "]": function() {
            this.attrs[this.attr] = this.val;
            this.attr = this.val = "";
            return this.GO(1);
          },
          def: function(c) {
            return this.val += c;
          },
          eof: SynthMachine.GO(12)
        }, {
          '"': SynthMachine.GO(8),
          def: function(c) {
            return this.text += c;
          },
          eof: SynthMachine.GO(12)
        }, {
          "'": SynthMachine.GO(8),
          def: function(c) {
            return this.text += c;
          },
          eof: SynthMachine.GO(12)
        }, {
          enter: function() {
            if (this.tag) {
              this.emitNode();
            }
            if (this.text) {
              this.emitText();
            }
            return this.GO(0);
          }
        }, {}, {
          enter: function() {
            this.emitNode();
            this.cursor = null;
            return this.GO(0);
          }
        }, {
          enter: function() {
            var _ref;
            this.emitNode();
            this.cursor = (_ref = this.cursor) != null ? _ref.parentNode : void 0;
            return this.GO(0);
          }
        }, {
          enter: function() {
            throw new Error("Error in synth expression: " + this.input);
          }
        }, {
          enter: function() {
            if (this.tag) {
              this.emitNode();
            }
            if (this.text) {
              return this.emitText();
            }
          }
        }
      ];

      function SynthMachine() {
        SynthMachine.__super__.constructor.call(this, SynthMachine.STATE_TABLE);
        this.fragment = this.cursor = document.createDocumentFragment();
      }

      SynthMachine.prototype.emitNode = function() {
        var k, node;
        if (this.tag) {
          node = document.createElement(this.tag);
          node.id = this.id || null;
          node.className = this.cls || null;
          for (k in this.attrs) {
            node.setAttribute(k, this.attrs[k]);
          }
          this.cursor.appendChild(node);
          return this.cursor = node;
        }
      };

      SynthMachine.prototype.emitText = function() {
        this.cursor.appendChild($.type.lookup("<html>").node(this.text));
        return this.text = "";
      };

      return SynthMachine;

    })($.StateMachine);
    return {
      $: {
        synth: function(expr) {
          var s;
          s = new SynthMachine();
          s.run(expr);
          if (s.fragment.childNodes.length === 1) {
            return $(s.fragment.childNodes[0]);
          } else {
            return $(s.fragment);
          }
        }
      }
    };
  });

  (function($) {
    var match_forward;
    $.plugin(function() {
      var current_engine, engines, template;
      current_engine = null;
      engines = {};
      template = {
        register_engine: function(name, render_func) {
          engines[name] = render_func;
          if (!(current_engine != null)) {
            return current_engine = name;
          }
        },
        render: function(text, args) {
          if (current_engine in engines) {
            return engines[current_engine](text, args);
          }
        }
      };
      template.__defineSetter__('engine', function(v) {
        if (!v in engines) {
          throw new Error("invalid template engine: " + v + " not one of " + (Object.Keys(engines)));
        } else {
          return current_engine = v;
        }
      });
      template.__defineGetter__('engine', function() {
        return current_engine;
      });
      return {
        name: 'Template',
        $: {
          template: template
        }
      };
    });
    $.template.register_engine('null', (function() {
      return function(text, values) {
        return text;
      };
    })());
    match_forward = function(text, find, against, start, stop) {
      var count, i, t, _i;
      if (stop == null) {
        stop = -1;
      }
      count = 1;
      if (stop < 0) {
        stop = text.length + 1 + stop;
      }
      for (i = _i = start; _i < stop; i = _i += 1) {
        t = text[i];
        if (t === against) {
          count += 1;
        } else if (t === find) {
          count -= 1;
        }
        if (count === 0) {
          return i;
        }
      }
      return -1;
    };
    $.template.register_engine('pythonic', (function() {
      var chunk_re, compile, render, type_re;
      type_re = /([0-9#0+-]*)\.*([0-9#+-]*)([diouxXeEfFgGcrsqm])((?:.|\n)*)/;
      chunk_re = /%[\(\/]/;
      compile = function(text) {
        var chunks, end, i, j, key, match, n, rest, ret, _i;
        chunks = text.split(chunk_re);
        n = chunks.length;
        ret = [chunks[0]];
        j = 1;
        for (i = _i = 1; _i < n; i = _i += 1) {
          end = match_forward(chunks[i], ')', '(', 0, -1);
          if (end === -1) {
            return "Template syntax error: unmatched '%(' starting at: " + (chunks[i].substring(0, 15));
          }
          key = chunks[i].substring(0, end);
          rest = chunks[i].substring(end);
          match = type_re.exec(rest);
          if (match === null) {
            return "Template syntax error: invalid type specifier starting at '" + rest + "'";
          }
          rest = match[4];
          ret[j++] = key;
          ret[j++] = match[1] | 0;
          ret[j++] = match[2] | 0;
          ret[j++] = match[3];
          ret[j++] = rest;
        }
        return ret;
      };
      compile.cache = {};
      render = function(text, values) {
        var cache, fixed, i, j, key, n, output, pad, rest, type, value, _i, _ref, _ref1;
        cache = compile.cache[text];
        if (!(cache != null)) {
          cache = compile.cache[text] = compile(text);
        }
        output = [cache[0]];
        j = 1;
        n = cache.length;
        for (i = _i = 1, _ref = n - 5; _i <= _ref; i = _i += 5) {
          _ref1 = cache.slice(i, +(i + 4) + 1 || 9e9), key = _ref1[0], pad = _ref1[1], fixed = _ref1[2], type = _ref1[3], rest = _ref1[4];
          value = values[key];
          if (!(value != null)) {
            value = "missing value: " + key;
          }
          switch (type) {
            case 'd':
              output[j++] = "" + parseInt(value, 10);
              break;
            case 'f':
              output[j++] = parseFloat(value).toFixed(fixed);
              break;
            case 's':
              output[j++] = "" + value;
              break;
            default:
              output[j++] = "" + value;
          }
          if (pad > 0) {
            output[j] = String.PadLeft(output[j], pad);
          }
          output[j++] = rest;
        }
        return output.join("");
      };
      return render;
    })());
    return $.template.register_engine('js-eval', (function() {
      var TemplateMachine;
      TemplateMachine = (function(_super) {

        __extends(TemplateMachine, _super);

        function TemplateMachine() {
          return TemplateMachine.__super__.constructor.apply(this, arguments);
        }

        TemplateMachine.STATE_TABLE = [
          {
            enter: function() {
              this.data = [];
              return this.GO(1);
            }
          }, {}
        ];

        return TemplateMachine;

      })($.StateMachine);
      return function(text, values) {
        return text;
      };
    })());
  })(Bling);

  $.plugin({
    provides: "throttle",
    depends: "core"
  }, function() {
    return {
      $: {
        throttle: function(ms, f) {
          var last;
          last = 0;
          return function() {
            var a, gap;
            a = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
            gap = $.now - last;
            if (gap > ms) {
              last += gap;
              return f.apply(this, a);
            }
            return null;
          };
        },
        debounce: function(ms, f) {
          var last;
          last = 0;
          return function() {
            var a, gap;
            a = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
            last += (gap = $.now - last);
            return f.apply(this, a(gap > ms ? void 0 : null));
          };
        }
      }
    };
  });

  $.plugin({
    depends: 'type',
    provides: 'TNET'
  }, function() {
    var parseArray, parseObject, parseOne;
    parseOne = function(data) {
      var extra, i, item, len, type;
      i = data.indexOf(":");
      if (i > 0) {
        len = parseInt(data.slice(0, i), 10);
        item = data.slice(i + 1, i + 1 + len);
        type = data[i + 1 + len];
        extra = data.slice(i + len + 2);
        item = (function() {
          switch (type) {
            case "#":
              return Number(item);
            case "'":
              return String(item);
            case "!":
              return item === "true";
            case "~":
              return null;
            case "]":
              return parseArray(item);
            case "}":
              return parseObject(item);
          }
        })();
        return [item, extra];
      }
      return void 0;
    };
    parseArray = function(x) {
      var data, one, _ref;
      data = [];
      while (x.length > 0) {
        _ref = parseOne(x), one = _ref[0], x = _ref[1];
        data.push(one);
      }
      return data;
    };
    parseObject = function(x) {
      var data, key, value, _ref, _ref1;
      data = {};
      while (x.length > 0) {
        _ref = parseOne(x), key = _ref[0], x = _ref[1];
        _ref1 = parseOne(x), value = _ref1[0], x = _ref1[1];
        data[key] = value;
      }
      return data;
    };
    return {
      $: {
        TNET: {
          stringify: function(x) {
            var data, type, y, _ref;
            _ref = (function() {
              switch ($.type(x)) {
                case "number":
                  return [String(x), "#"];
                case "string":
                  return [x, "'"];
                case "function":
                  return [String(x), "'"];
                case "boolean":
                  return [String(!!x), "!"];
                case "null":
                  return ["", "~"];
                case "undefined":
                  return ["", "~"];
                case "array":
                  return [
                    ((function() {
                      var _i, _len, _results;
                      _results = [];
                      for (_i = 0, _len = x.length; _i < _len; _i++) {
                        y = x[_i];
                        _results.push($.TNET.stringify(y));
                      }
                      return _results;
                    })()).join(''), "]"
                  ];
                case "object":
                  return [
                    ((function() {
                      var _results;
                      _results = [];
                      for (y in x) {
                        _results.push($.TNET.stringify(y) + $.TNET.stringify(x[y]));
                      }
                      return _results;
                    })()).join(''), "}"
                  ];
              }
            })(), data = _ref[0], type = _ref[1];
            return (data.length | 0) + ":" + data + type;
          },
          parse: function(x) {
            var _ref;
            return (_ref = parseOne(x)) != null ? _ref[0] : void 0;
          }
        }
      }
    };
  });

  $.plugin({
    provides: "trace",
    depends: "function,type"
  }, function() {
    $.type.extend({
      unknown: {
        trace: $.identity
      },
      object: {
        trace: function(label, o, tracer) {
          var k, _i, _len, _ref;
          _ref = Object.keys(o);
          for (_i = 0, _len = _ref.length; _i < _len; _i++) {
            k = _ref[_i];
            o[k] = $.trace(o[k], "" + label + "." + k, tracer);
          }
          return o;
        }
      },
      array: {
        trace: function(label, o, tracer) {
          var i, _i, _ref;
          for (i = _i = 0, _ref = o.length; _i < _ref; i = _i += 1) {
            o[i] = $.trace(o[i], "" + label + "[" + i + "]", tracer);
          }
          return o;
        }
      },
      "function": {
        trace: function(label, f, tracer) {
          var r;
          label || (label = f.name);
          r = function() {
            var a;
            a = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
            tracer("" + (this.name || $.type(this)) + "." + label + "(" + ($(a).map($.toRepr).join(',')) + ")");
            return f.apply(this, a);
          };
          r.toString = function() {
            return "{Trace '" + label + "' of " + (f.toString());
          };
          return r;
        }
      }
    });
    return {
      $: {
        trace: function(label, o, tracer) {
          var _ref;
          if (!$.is("string", label)) {
            _ref = [o, label], tracer = _ref[0], o = _ref[1];
          }
          tracer || (tracer = $.log);
          label || (label = "");
          return $.type.lookup(o).trace(label, o, tracer);
        }
      }
    };
  });

  $.plugin({
    depends: "dom"
  }, function() {
    var COMMASEP, accel_props_re, speeds, testStyle, transformProperty, transitionDuration, transitionProperty, transitionTiming, updateDelay;
    COMMASEP = ", ";
    speeds = {
      "slow": 700,
      "medium": 500,
      "normal": 300,
      "fast": 100,
      "instant": 0,
      "now": 0
    };
    accel_props_re = /(?:scale(?:3d)*|translate(?:[XYZ]|3d)*|rotate(?:[XYZ]|3d)*)/;
    updateDelay = 30;
    testStyle = document.createElement("div").style;
    transformProperty = "transform";
    transitionProperty = "transition-property";
    transitionDuration = "transition-duration";
    transitionTiming = "transition-timing-function";
    if ("WebkitTransform" in testStyle) {
      transformProperty = "-webkit-transform";
      transitionProperty = "-webkit-transition-property";
      transitionDuration = "-webkit-transition-duration";
      transitionTiming = "-webkit-transition-timing-function";
    } else if ("MozTransform" in testStyle) {
      transformProperty = "-moz-transform";
      transitionProperty = "-moz-transition-property";
      transitionDuration = "-moz-transition-duration";
      transitionTiming = "-moz-transition-timing-function";
    } else if ("OTransform" in testStyle) {
      transformProperty = "-o-transform";
      transitionProperty = "-o-transition-property";
      transitionDuration = "-o-transition-duration";
      transitionTiming = "-o-transition-timing-function";
    }
    return {
      $: {
        duration: function(speed) {
          var d;
          d = speeds[speed];
          if (d != null) {
            return d;
          }
          return parseFloat(speed);
        }
      },
      transform: function(end_css, speed, easing, callback) {
        var css, duration, i, ii, props, trans;
        if ($.is("function", speed)) {
          callback = speed;
          speed = easing = null;
        } else if ($.is("function", easing)) {
          callback = easing;
          easing = null;
        }
        if (speed == null) {
          speed = "normal";
        }
        easing || (easing = "ease");
        duration = $.duration(speed) + "ms";
        props = [];
        trans = "";
        css = {};
        for (i in end_css) {
          if (accel_props_re.test(i)) {
            ii = end_css[i];
            if (ii.join) {
              ii = $(ii).px().join(COMMASEP);
            } else if (ii.toString) {
              ii = ii.toString();
            }
            trans += " " + i + "(" + ii + ")";
          } else {
            css[i] = end_css[i];
          }
        }
        for (i in css) {
          props.push(i);
        }
        if (trans) {
          props.push(transformProperty);
        }
        css[transitionProperty] = props.join(COMMASEP);
        css[transitionDuration] = props.map(function() {
          return duration;
        }).join(COMMASEP);
        css[transitionTiming] = props.map(function() {
          return easing;
        }).join(COMMASEP);
        if (trans) {
          css[transformProperty] = trans;
        }
        this.css(css);
        return this.delay(duration, callback);
      },
      hide: function(callback) {
        this.each(function() {
          if (this.style) {
            this._display = "";
            if (this.style.display === !"none") {
              this._display = this.syle.display;
            }
            return this.style.display = "none";
          }
        }).trigger("hide");
        if (callback) {
          this.delay(updateDelay, callback);
        }
        return this;
      },
      show: function(callback) {
        this.each(function() {
          if (this.style) {
            this.style.display = this._display;
            return delete this._display;
          }
        }).trigger("show");
        if (callback) {
          this.delay(updateDelay, callback);
        }
        return this;
      },
      toggle: function(callback) {
        return this.weave(this.css("display")).fold(function(display, node) {
          if (display === "none") {
            node.style.display = node._display || "";
            delete node._display;
            $(node).trigger("show");
          } else {
            node._display = display;
            node.style.display = "none";
            $(node).trigger("hide");
          }
          return node;
        }).delay(updateDelay, callback);
      },
      fadeIn: function(speed, callback) {
        return this.css('opacity', '0.0').show(function() {
          return this.transform({
            opacity: "1.0",
            translate3d: [0, 0, 0]
          }, speed, callback);
        });
      },
      fadeOut: function(speed, callback, x, y) {
        if (x == null) {
          x = 0.0;
        }
        if (y == null) {
          y = 0.0;
        }
        return this.transform({
          opacity: "0.0",
          translate3d: [x, y, 0.0]
        }, speed, function() {
          return this.hide(callback);
        });
      },
      fadeLeft: function(speed, callback) {
        return this.fadeOut(speed, callback, "-" + this.width().first(), 0.0);
      },
      fadeRight: function(speed, callback) {
        return this.fadeOut(speed, callback, this.width().first(), 0.0);
      },
      fadeUp: function(speed, callback) {
        return this.fadeOut(speed, callback, 0.0, "-" + this.height().first());
      },
      fadeDown: function(speed, callback) {
        return this.fadeOut(speed, callback, 0.0, this.height().first());
      }
    };
  });

  $.plugin({
    provides: "type"
  }, function() {
    var inherit, isType, _type;
    isType = function(T, o) {
      if (!(o != null)) {
        return T === o || T === "null" || T === "undefined";
      } else {
        return ((o.constructor != null) && (o.constructor === T || o.constructor.name === T)) || Object.prototype.toString.apply(o) === ("[object " + T + "]") || isType(T, o.__proto__);
      }
    };
    inherit = function(parent, obj) {
      if (typeof parent === "function") {
        parent = parent.prototype;
      }
      if (parent.__proto__ === Object.prototype) {
        parent.__proto__ = obj.__proto__;
      }
      obj.__proto__ = parent;
      return obj;
    };
    _type = (function() {
      var base, cache, lookup, order, register, _extend;
      cache = {};
      base = {
        name: 'unknown',
        match: function(o) {
          return true;
        }
      };
      order = [];
      register = function(name, data) {
        if (!(name in cache)) {
          order.unshift(name);
        }
        cache[data.name = name] = base !== data ? inherit(base, data) : data;
        return cache[name][name] = function(o) {
          return o;
        };
      };
      _extend = function(name, data) {
        var k, _ref, _results;
        if (typeof name === "string") {
          if ((_ref = cache[name]) == null) {
            cache[name] = register(name, {});
          }
          return cache[name] = extend(cache[name], data);
        } else if (typeof name === "object") {
          _results = [];
          for (k in name) {
            _results.push(_extend(k, name[k]));
          }
          return _results;
        }
      };
      lookup = function(obj) {
        var name, _i, _len, _ref;
        for (_i = 0, _len = order.length; _i < _len; _i++) {
          name = order[_i];
          if ((_ref = cache[name]) != null ? _ref.match.call(obj, obj) : void 0) {
            return cache[name];
          }
        }
      };
      register("unknown", base);
      register("object", {
        match: function() {
          return typeof this === "object";
        }
      });
      register("error", {
        match: function() {
          return isType('Error', this);
        }
      });
      register("regexp", {
        match: function() {
          return isType('RegExp', this);
        }
      });
      register("string", {
        match: function() {
          return typeof this === "string" || isType(String, this);
        }
      });
      register("number", {
        match: function() {
          return (isType(Number, this)) && this !== NaN;
        }
      });
      register("bool", {
        match: function() {
          return typeof this === "boolean" || (function() {
            var _ref;
            try {
              return (_ref = String(this)) === "true" || _ref === "false";
            } catch (_error) {}
          }).call(this);
        }
      });
      register("array", {
        match: Array.isArray || function() {
          return isType(Array, this);
        }
      });
      register("function", {
        match: function() {
          return typeof this === "function";
        }
      });
      register("global", {
        match: function() {
          return typeof this === "object" && 'setInterval' in this;
        }
      });
      register("undefined", {
        match: function(x) {
          return x === void 0;
        }
      });
      register("null", {
        match: function(x) {
          return x === null;
        }
      });
      return extend((function(o) {
        return lookup(o).name;
      }), {
        register: register,
        lookup: lookup,
        extend: _extend,
        is: function(t, o) {
          var _ref;
          return (_ref = cache[t]) != null ? _ref.match.call(o, o) : void 0;
        },
        as: function() {
          var o, rest, t, _base;
          t = arguments[0], o = arguments[1], rest = 3 <= arguments.length ? __slice.call(arguments, 2) : [];
          return typeof (_base = lookup(o))[t] === "function" ? _base[t].apply(_base, [o].concat(__slice.call(rest))) : void 0;
        }
      });
    })();
    _type.extend({
      unknown: {
        array: function(o) {
          return [o];
        }
      },
      "null": {
        array: function(o) {
          return [];
        }
      },
      undefined: {
        array: function(o) {
          return [];
        }
      },
      array: {
        array: function(o) {
          return o;
        }
      },
      number: {
        array: function(o) {
          return Bling.extend(new Array(o), {
            length: 0
          });
        }
      }
    });
    _type.register("bling", {
      match: function(o) {
        return o && isType(Bling, o);
      },
      array: function(o) {
        return o.toArray();
      },
      hash: function(o) {
        return o.map(Bling.hash).reduce(function(a, x) {
          return (a * a) + x;
        });
      },
      string: function(o) {
        return Bling.symbol + "([" + o.map(function(x) {
          return $.type.lookup(x).string(x);
        }).join(", ") + "])";
      },
      repr: function(o) {
        return Bling.symbol + "([" + o.map(function(x) {
          return $.type.lookup(x).repr(x);
        }).join(", ") + "])";
      }
    });
    return {
      $: {
        inherit: inherit,
        extend: extend,
        defineProperty: function(o, name, opts) {
          Object.defineProperty(o, name, extend({
            configurable: true,
            enumerable: true
          }, opts));
          return o;
        },
        isType: isType,
        type: _type,
        is: _type.is,
        as: _type.as,
        isSimple: function(o) {
          var _ref;
          return (_ref = _type(o)) === "string" || _ref === "number" || _ref === "bool";
        },
        isEmpty: function(o) {
          return (o === "" || o === null || o === (void 0)) || o.length === 0 || (typeof o === "object" && Object.keys(o).length === 0);
        }
      },
      defineProperty: function(name, opts) {
        return this.each(function() {
          return $.defineProperty(this, name, opts);
        });
      }
    };
  });

  $.plugin({
    depends: 'math',
    provides: 'units'
  }, function() {
    var UNIT_RE, conv, convertNumber, fillConversions, initialize, locker, makeUnitRegex, parseUnits, setConversion, units;
    units = $(["px", "pt", "pc", "em", "%", "in", "cm", "mm", "ex", "lb", "kg", "yd", "ft", "m", ""]);
    UNIT_RE = null;
    (makeUnitRegex = function() {
      var joined;
      joined = units.filter(/.+/).join('|');
      return UNIT_RE = new RegExp("(\\d+\\.*\\d*)((?:" + joined + ")/*(?:" + joined + ")*)");
    })();
    parseUnits = function(s) {
      if (UNIT_RE.test(s)) {
        return UNIT_RE.exec(s)[2];
      }
      return "";
    };
    conv = function(a, b) {
      var denom_a, denom_b, numer_a, numer_b, _ref, _ref1;
      _ref = a.split('/'), numer_a = _ref[0], denom_a = _ref[1];
      _ref1 = b.split('/'), numer_b = _ref1[0], denom_b = _ref1[1];
      if ((denom_a != null) && (denom_b != null)) {
        return conv(denom_b, denom_a) * conv(numer_a, numer_b);
      }
      if (a in conv) {
        if (b in conv[a]) {
          return conv[a][b]();
        }
      }
      return 0;
    };
    locker = function(x) {
      return function() {
        return x;
      };
    };
    fillConversions = function() {};
    setConversion = function(from, to, f) {
      conv[from] || (conv[from] = {});
      conv[from][to] = f;
      if (units.indexOf(from) === -1) {
        units.push(from);
      }
      if (units.indexOf(to) === -1) {
        units.push(to);
      }
      makeUnitRegex();
      return fillConversions();
    };
    initialize = function() {
      setConversion('pc', 'pt', function() {
        return 12;
      });
      setConversion('in', 'pt', function() {
        return 72;
      });
      setConversion('in', 'px', function() {
        return 96;
      });
      setConversion('in', 'cm', function() {
        return 2.54;
      });
      setConversion('m', 'ft', function() {
        return 3.281;
      });
      setConversion('yd', 'ft', function() {
        return 3;
      });
      setConversion('cm', 'mm', function() {
        return 10;
      });
      setConversion('m', 'cm', function() {
        return 100;
      });
      setConversion('m', 'meter', function() {
        return 1;
      });
      setConversion('m', 'meters', function() {
        return 1;
      });
      setConversion('ft', 'feet', function() {
        return 1;
      });
      setConversion('km', 'm', function() {
        return 1000;
      });
      setConversion('em', 'px', function() {
        var w, x;
        w = 0;
        try {
          x = $("<span style='font-size:1em;visibility:hidden'>x</span>").appendTo("body");
          w = x.width().first();
          x.remove();
        } catch (_error) {}
        return w;
      });
      setConversion('ex', 'px', function() {
        var w, x;
        w = 0;
        try {
          x = $("<span style='font-size:1ex;visibility:hidden'>x</span>").appendTo("body");
          w = x.width().first();
          x.remove();
        } catch (_error) {}
        return w;
      });
      setConversion('ex', 'em', function() {
        return 2;
      });
      setConversion('rad', 'deg', function() {
        return 57.3;
      });
      setConversion('s', 'sec', function() {
        return 1;
      });
      setConversion('s', 'ms', function() {
        return 1000;
      });
      setConversion('ms', 'ns', function() {
        return 1000000;
      });
      setConversion('min', 'sec', function() {
        return 60;
      });
      setConversion('hr', 'min', function() {
        return 60;
      });
      setConversion('hr', 'hour', function() {
        return 1;
      });
      setConversion('hr', 'hours', function() {
        return 1;
      });
      setConversion('day', 'hr', function() {
        return 24;
      });
      setConversion('day', 'days', function() {
        return 1;
      });
      setConversion('y', 'year', function() {
        return 1;
      });
      setConversion('y', 'years', function() {
        return 1;
      });
      setConversion('y', 'd', function() {
        return 365.25;
      });
      setConversion('g', 'gram', function() {
        return 1;
      });
      setConversion('g', 'grams', function() {
        return 1;
      });
      setConversion('kg', 'g', function() {
        return 1000;
      });
      setConversion('lb', 'g', function() {
        return 453.6;
      });
      setConversion('lb', 'oz', function() {
        return 16;
      });
      setConversion('f', 'frame', function() {
        return 1;
      });
      setConversion('f', 'frames', function() {
        return 1;
      });
      setConversion('sec', 'f', function() {
        return 60;
      });
      (fillConversions = function() {
        var a, b, c, infered, one, _i, _j, _k, _l, _len, _len1, _len2, _len3;
        conv[''] = {};
        one = locker(1.0);
        for (_i = 0, _len = units.length; _i < _len; _i++) {
          a = units[_i];
          conv[a] || (conv[a] = {});
          conv[a][a] = conv[a][''] = conv[''][a] = one;
        }
        infered = 1;
        while (infered > 0) {
          infered = 0;
          for (_j = 0, _len1 = units.length; _j < _len1; _j++) {
            a = units[_j];
            if (!(a !== '')) {
              continue;
            }
            conv[a] || (conv[a] = {});
            for (_k = 0, _len2 = units.length; _k < _len2; _k++) {
              b = units[_k];
              if (!(b !== '')) {
                continue;
              }
              if ((!conv(a, b)) && (conv(b, a))) {
                conv[a][b] = locker(1.0 / conv(b, a));
                infered += 1;
              }
              for (_l = 0, _len3 = units.length; _l < _len3; _l++) {
                c = units[_l];
                if (c !== '') {
                  if ((conv(a, b)) && (conv(b, c)) && (!conv(a, c))) {
                    conv[a][c] = locker(conv(a, b) * conv(b, c));
                    infered += 1;
                  }
                }
              }
            }
          }
        }
        return null;
      })();
      return $.units.enable = function() {};
    };
    convertNumber = function(number, unit) {
      var c, f, u;
      f = parseFloat(number);
      u = parseUnits(number);
      c = conv(u, unit);
      if (!(isFinite(c) && isFinite(f))) {
        return number;
      }
      return "" + (f * c) + unit;
    };
    $.type.register("units", {
      match: function(x) {
        return typeof x === "string" && UNIT_RE.test(x);
      },
      number: function(x) {
        return parseFloat(x);
      },
      string: function(x) {
        return "'" + x + "'";
      }
    });
    return {
      $: {
        units: {
          enable: initialize,
          set: setConversion,
          get: conv,
          convertTo: function(unit, obj) {
            return convertNumber(obj, unit);
          }
        }
      },
      convertTo: function(unit) {
        return this.map(function(x) {
          return convertNumber(x, unit);
        });
      },
      unitMap: function(f) {
        return this.map(function(x) {
          var n;
          return f.call((n = parseFloat(x)), n) + parseUnits(x);
        });
      }
    };
  });

  $.plugin({
    provides: "unittest",
    depends: "core,function"
  }, function() {
    var failCount, failed, invokeTest, passCount, testCount, testReport;
    testCount = passCount = failCount = 0;
    failed = [];
    invokeTest = function(group, name, func) {
      var done, f, shouldFail, _log;
      if (!$.is("function", func)) {
        return;
      }
      _log = function(msg) {
        return $.log("" + group + ": " + name + "... " + msg);
      };
      shouldFail = name.toLowerCase().indexOf("fail") !== -1;
      done = $.once(function(err) {
        testCount--;
        if (!!err !== shouldFail) {
          _log("fail: " + err);
          failCount++;
          return failed.push(name);
        } else {
          _log("pass");
          passCount++;
          return $.provide(name);
        }
      });
      f = function(done) {
        try {
          return func(done);
        } catch (err) {
          return done(err);
        } finally {
          if (name.toLowerCase().indexOf("async") === -1) {
            done();
          }
        }
      };
      testCount++;
      try {
        return f(done);
      } catch (err) {
        return done(err);
      }
    };
    testReport = $.once(function() {
      $.log("Passed: " + passCount + " Failed: " + failCount + " [" + failed + "]");
      if (failCount > 0) {
        try {
          return process.exit(failCount);
        } catch (_error) {}
      }
    });
    return {
      $: {
        approx: function(a, b, margin) {
          if (margin == null) {
            margin = .1;
          }
          return Math.abs(a - b) < margin;
        },
        assert: function(cnd, msg) {
          if (msg == null) {
            msg = "no message";
          }
          if (!cnd) {
            throw new Error("Assertion failed: " + msg);
          }
        },
        assertEqual: function(a, b, label) {
          if (a !== b) {
            throw Error("" + (label || '') + " (" + (a != null ? a.toString() : void 0) + ") should equal (" + (b != null ? b.toString() : void 0) + ")");
          }
        },
        assertArrayEqual: function(a, b, label) {
          var i, _i, _ref, _results;
          _results = [];
          for (i = _i = 0, _ref = a.length; _i < _ref; i = _i += 1) {
            try {
              _results.push($.assertEqual(a[i], b[i], label));
            } catch (err) {
              throw Error("" + (label || '') + " " + (a != null ? a.toString() : void 0) + " should equal " + (b != null ? b.toString() : void 0));
            }
          }
          return _results;
        },
        testGroup: function(name, funcs) {
          var func, interval, k, _results;
          interval = setInterval((function() {
            if (testCount === 0) {
              clearInterval(interval);
              return testReport();
            }
          }), 50);
          _results = [];
          for (k in funcs) {
            func = funcs[k];
            _results.push(invokeTest(name, k, func));
          }
          return _results;
        }
      },
      assertEqual: function() {
        var a, args, i, _i, _ref,
          _this = this;
        args = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
        if (args.length > 1) {
          args = args.map(function(x) {
            if ($.is("function", x)) {
              return x.call(_this, _this);
            } else {
              return x;
            }
          });
          a = args[0];
          for (i = _i = 1, _ref = args.length; 1 <= _ref ? _i < _ref : _i > _ref; i = 1 <= _ref ? ++_i : --_i) {
            $.assertEqual(a, args[i]);
          }
        }
        return this;
      }
    };
  });

  $.plugin({
    depends: 'dialog',
    provides: 'wizard'
  }, function() {
    return {
      $: {
        wizard: function() {
          var currentSlide, d, modal, slide, slideChanger, slides, _i, _len, _ref, _ref1;
          slides = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
          if (slides.length === 1 && ((_ref = $.type(slides[0])) === 'array' || _ref === 'bling')) {
            slides = slides[0];
          }
          currentSlide = 0;
          modal = $.dialog(slides[0]).select('parentNode');
          slideChanger = function(delta) {
            return function() {
              var currentDialog, dialogs, newDialog, newLeft, newSlide;
              if (slides.length === 0) {
                return;
              }
              newSlide = (currentSlide + delta) % slides.length;
              while (newSlide < 0) {
                newSlide += slides.length;
              }
              if (newSlide === currentSlide) {
                return;
              }
              dialogs = modal.find('.dialog');
              currentDialog = $(dialogs[currentSlide]);
              newDialog = $(dialogs[newSlide]);
              newLeft = delta < 0 ? newLeft = window.innerWidth : -currentDialog.width().scale(1.5).first();
              currentDialog.removeClass('wiz-active').css({
                left: $.px(newLeft)
              });
              newDialog.addClass('wiz-active').centerOn(modal).show();
              return currentSlide = newSlide;
            };
          };
          modal.delegate('.wiz-next', 'click', slideChanger(+1));
          modal.delegate('.wiz-back', 'click', slideChanger(-1));
          _ref1 = slides.slice(1);
          for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
            slide = _ref1[_i];
            d = $.synth('div.dialog div.title + div.content').css({
              left: $.px(window.innerWidth + 100)
            }).appendTo(modal);
            slide = $.extend($.dialog.getDefaultOptions(), slide);
            d.find('.title').append($.dialog.getContent(slide.titleType, slide.title));
            d.find('.content').append($.dialog.getContent(slide.contentType, slide.content));
          }
          return modal;
        }
      }
    };
  });

}).call(this);
