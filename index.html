<!DOCTYPE html>
<html>
	<head>
		<title>None</title>
		<script src="js/bling.js"></script>
		<style type="text/css">
			body { padding: 0; margin: 0; overflow: hidden; }
			canvas { padding: 0; margin: 0; }
		</style>
	</head>
	<body>
		<canvas></canvas>
		<script type="text/javascript" src="js/coffee-script.js"></script>
		<script type="text/coffeescript" src="js/clock.coffee"></script>
		<script type="text/coffeescript">
			body = document.body
			aspect_ratio = 16 / 9
			h = Math.max(body.scrollHeight, body.clientHeight)
			w = h / aspect_ratio
			canvas = $("canvas")
				.zap("height", h)
				.zap("width", w)
				.css
					position: "fixed"
					left: "50%"
					"margin-left": $.px(-w/2)
			context = canvas.select('getContext').call('2d')
			context.drawRect = (x,y,w,h,fill,stroke) ->
				@zap('fillStyle', fill)
					.zap('strokeStyle', stroke)
					.select('fillRect')
					.call(x,y,w,h)

			context.drawRect 0,0, w,h, 'black'
			context.drawRect w/4,h/4, w/2, h/2, 'gray'

			clock = new Clock()
			canvas.bind 'click', -> clock.toggle()
			objects = []
			clock.on 'tick', (dt) ->
				for obj in objects
					obj.tick(dt)
				for obj in objects
					context.map -> obj.draw @

			class Rect
				constructor: (@x,@y,@w,@h,@fill,@stroke) ->
				tick: (dt) ->
				draw: (ctx) ->
					ctx.beginPath()
					ctx.rect @x,@y,@w,@h
					ctx.closePath()
					if @fill
						ctx.fillStyle = @fill
						ctx.fill()
					if @stroke
						ctx.strokeStyle = @stroke
						ctx.stroke()

			class Circle
				constructor: (@x,@y,@r,@fill,@stroke) ->
				tick: (dt) ->
				draw: (ctx) ->
					ctx.beginPath()
					ctx.arc @x, @y, @r, 0, Math.PI*2, true
					ctx.closePath()
					if @fill
						ctx.fillStyle = @fill
						ctx.fill()
					if @stroke
						ctx.strokeStyle = @stroke
						ctx.stroke()

			objects.push new Rect 0,0,w,h,'green'
			objects.push new Circle w/2,h/2,w/4,'red'

		</script>
	</body>
</html>
